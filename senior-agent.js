// Senior Topic Discovery Agent - Main Logic

// ===== ì¹´í…Œê³ ë¦¬ ë°œêµ´ ë°ì´í„°ë² ì´ìŠ¤ (50+ ì¹´í…Œê³ ë¦¬) =====
const discoveryCategories = [
    // === ë¼ì´í”„ìŠ¤íƒ€ì¼ ===
    { id: 'elderly-love', name: 'í™©í˜¼ ë¡œë§¨ìŠ¤', icon: 'ğŸ’‘', description: '60ëŒ€ ì´í›„ì˜ ìƒˆë¡œìš´ ì‚¬ë‘, ì¬í˜¼, ë™ë°˜ì ì´ì•¼ê¸°', blueOcean: 95, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '100ë§Œ~400ë§Œì›', reason: 'ê³ ë ¹í™” ì‹œëŒ€, í™©í˜¼ ë¡œë§¨ìŠ¤ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ê¸‰ì¦', sampleTopics: ['60ëŒ€ì— ì‹œì‘ëœ ìƒˆ ì‚¬ë‘', 'ì¬í˜¼ í›„ í–‰ë³µí•´ì§„ ì´ì•¼ê¸°', 'í™©í˜¼ ë°ì´íŠ¸ ë…¸í•˜ìš°'] },
    { id: 'simple-life', name: 'ë¯¸ë‹ˆë©€ ë¼ì´í”„', icon: 'ğŸ¡', description: 'ë¬¼ê±´ ì •ë¦¬, ë‹¨ìˆœí•œ ì‚¶, ë‹¤ìš´ì‚¬ì´ì§•', blueOcean: 83, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~280ë§Œì›', reason: 'ë¬¼ê±´ê³¼ ë§ˆìŒ ì •ë¦¬ëŠ” ì‹œë‹ˆì–´ì˜ ì£¼ìš” ê´€ì‹¬ì‚¬', sampleTopics: ['60ë…„ ëª¨ì€ ë¬¼ê±´ ë‹¤ ë²„ë ¸ë”ë‹ˆ', 'ì‘ì€ ì§‘ì—ì„œ í–‰ë³µí•˜ê²Œ ì‚¬ëŠ” ë²•'] },
    { id: 'rural-life', name: 'ê·€ë†ê·€ì´Œ', icon: 'ğŸŒ¾', description: 'ì‹œê³¨ ìƒí™œ, ê·€ë† ì¤€ë¹„, í…ƒë°­ ê°€ê¾¸ê¸°', blueOcean: 80, competition: 'ì¤‘ê°„', avgRevenue: '90ë§Œ~320ë§Œì›', reason: 'ì€í‡´ í›„ ì œ2ì˜ ì‚¶ìœ¼ë¡œ ê·€ë†ê·€ì´Œì„ ê¿ˆê¾¸ëŠ” ì‹œë‹ˆì–´ê°€ ë§ìŒ', sampleTopics: ['ê·€ë† 3ë…„ì°¨ê°€ ì•Œë ¤ì£¼ëŠ” í˜„ì‹¤', 'í…ƒë°­ ì´ˆë³´ë„ ì„±ê³µí•˜ëŠ” ì‘ë¬¼'] },
    { id: 'solo-aging', name: 'í˜¼ì ëŠ™ê¸°', icon: 'ğŸš¶', description: 'ë…ê±° ìƒí™œ, 1ì¸ ê°€êµ¬ ì¤€ë¹„, ì™¸ë¡œì›€ ê·¹ë³µ', blueOcean: 92, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ë…ê±° ë…¸ì¸ ì¦ê°€ë¡œ ê´€ë ¨ ì½˜í…ì¸  ìˆ˜ìš” í­ë°œ', sampleTopics: ['í˜¼ì ì‚¬ëŠ” 70ëŒ€ì˜ í•˜ë£¨', 'ì™¸ë¡œì›€ì„ ì´ê¸°ëŠ” ë°©ë²•', 'ë…ê±° ìƒí™œ ì¤€ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸'] },
    { id: 'senior-fashion', name: 'ì‹œë‹ˆì–´ íŒ¨ì…˜', icon: 'ğŸ‘”', description: '60ëŒ€ ìŠ¤íƒ€ì¼ë§, í¸í•œ ì˜·, ë‚˜ì´ ë“¤ì–´ë„ ë©‹ì§€ê²Œ', blueOcean: 88, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'ë©‹ì§„ ë…¸ë…„ì— ëŒ€í•œ ê´€ì‹¬ ì¦ê°€', sampleTopics: ['60ëŒ€ë„ ì²­ë°”ì§€ ì…ì–´ë„ ë ê¹Œ', 'ë‚˜ì´ ë“¤ìˆ˜ë¡ í”¼í•´ì•¼ í•  ì˜·', 'ì–´ë””ì„œ ì˜· ì‚¬ì„¸ìš”?'] },
    { id: 'morning-routine', name: 'ì‹œë‹ˆì–´ ëª¨ë‹ë£¨í‹´', icon: 'ğŸŒ…', description: 'ê±´ê°•í•œ ì•„ì¹¨ ìŠµê´€, ìƒˆë²½ ìƒí™œ, í•˜ë£¨ ì‹œì‘ë²•', blueOcean: 85, competition: 'ë‚®ìŒ', avgRevenue: '60ë§Œ~200ë§Œì›', reason: 'ì‹œë‹ˆì–´ ìœ íŠœë²„ ì¼ìƒ ì½˜í…ì¸ ì— ëŒ€í•œ ê´€ì‹¬', sampleTopics: ['ìƒˆë²½ 4ì‹œì— ì¼ì–´ë‚˜ëŠ” ì´ìœ ', 'ì•„ì¹¨ì— ì´ê²ƒë§Œ í•˜ë©´ ê±´ê°•í•´ì ¸ìš”', '70ëŒ€ ìœ íŠœë²„ì˜ ëª¨ë‹ë£¨í‹´'] },

    // === ê°ì •/ì‚¬ì—° ===
    { id: 'end-of-life', name: 'ì¸ìƒ ë§ˆë¬´ë¦¬', icon: 'ğŸ•¯ï¸', description: 'ìœ ì–¸, ìƒì†, ì¥ë¡€ ì¤€ë¹„, ì‚¶ì˜ ì •ë¦¬', blueOcean: 91, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '150ë§Œ~500ë§Œì›', reason: 'í„°ë¶€ì‹œë˜ì§€ë§Œ ëª¨ë‘ ê´€ì‹¬ ìˆëŠ” ì£¼ì œ', sampleTopics: ['ìë…€ì—ê²Œ ë‚¨ê¸°ëŠ” ìœ ì–¸ì¥ ì‘ì„±ë²•', 'ë‚´ ì¥ë¡€ì‹ ë¯¸ë¦¬ ì¤€ë¹„í•˜ê¸°'] },
    { id: 'regret-stories', name: 'í›„íšŒ ì´ì•¼ê¸°', icon: 'ğŸ˜”', description: 'ì‚´ë©´ì„œ ê°€ì¥ í›„íšŒë˜ëŠ” ì¼, ì¸ìƒ êµí›ˆ', blueOcean: 89, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ì§„ì†”í•œ ì¸ìƒ ì´ì•¼ê¸°ì— ëŒ€í•œ ê³µê° ìˆ˜ìš”', sampleTopics: ['70ë…„ ì‚´ë©´ì„œ ê°€ì¥ í›„íšŒë˜ëŠ” ì¼', 'ê·¸ë•Œ ê·¸ë ‡ê²Œ í–ˆì–´ì•¼ í–ˆëŠ”ë°', 'ì Šì€ì´ë“¤ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§'] },
    { id: 'family-conflict', name: 'ê°€ì¡± ê°ˆë“±', icon: 'ğŸ’”', description: 'ê³ ë¶€ê°ˆë“±, í˜•ì œ ë¶„ìŸ, ìƒì† ë‹¤íˆ¼ í•´ê²°', blueOcean: 86, competition: 'ë‚®ìŒ', avgRevenue: '100ë§Œ~350ë§Œì›', reason: 'ëˆ„êµ¬ë‚˜ ê²ªëŠ” ê°€ì¡± ë¬¸ì œì— ëŒ€í•œ ê³µê°', sampleTopics: ['ë©°ëŠë¦¬ì™€ í™”í•´í•œ ë°©ë²•', 'í˜•ì œê°„ ìƒì† ë¶„ìŸ í•´ê²°ê¸°', 'ì†ì ˆí•œ ìë…€ì™€ ì—°ë½ì´ ì™”ë‹¤'] },
    { id: 'gratitude-diary', name: 'ê°ì‚¬ ì¼ê¸°', icon: 'ğŸ“”', description: 'ê¸ì • ë§ˆì¸ë“œ, ê°ì‚¬ ìŠµê´€, í–‰ë³µ ë¹„ê²°', blueOcean: 84, competition: 'ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'ì •ì„œì  ì›°ë¹™ì— ëŒ€í•œ ê´€ì‹¬ ì¦ê°€', sampleTopics: ['ë§¤ì¼ ê°ì‚¬í•˜ë‹ˆ ì¸ìƒì´ ë°”ë€Œì—ˆì–´ìš”', 'ì‘ì€ ê²ƒì— í–‰ë³µí•´ì§€ëŠ” ë²•', 'ë¶ˆí‰ ëŒ€ì‹  ê°ì‚¬'] },
    { id: 'life-wisdom', name: 'ì¸ìƒ êµí›ˆ', icon: 'ğŸ“–', description: 'ì‚´ì•„ì˜¨ ì§€í˜œ, ê²½í—˜ì—ì„œ ë°°ìš´ ê²ƒ', blueOcean: 82, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'ì‹œë‹ˆì–´ì˜ ì§€í˜œë¥¼ ë“£ê³  ì‹¶ì–´í•˜ëŠ” ì Šì€ ì¸µ', sampleTopics: ['80ë…„ ì‚´ì•„ë³´ë‹ˆ ì•Œê²Œ ëœ ê²ƒ', 'ì Šì—ˆì„ ë•Œ ëª°ëë˜ ì§„ì‹¤', 'ì¸ìƒ ì„ ë°°ê°€ ì „í•˜ëŠ” ì¡°ì–¸'] },

    // === ê±´ê°•/ì˜ë£Œ ===
    { id: 'senior-fitness', name: 'ì‹œë‹ˆì–´ ìš´ë™', icon: 'ğŸ§˜', description: 'ê´€ì ˆì— ë¬´ë¦¬ ì—†ëŠ” ìš´ë™, ì‹¤ë²„ ìš”ê°€', blueOcean: 75, competition: 'ì¤‘ê°„', avgRevenue: '120ë§Œ~450ë§Œì›', reason: 'ì‹œë‹ˆì–´ ë§ì¶¤ ìš´ë™ì€ ê´‘ê³  ë‹¨ê°€ê°€ ë†’ìŒ', sampleTopics: ['ë¬´ë¦ ì•„í”ˆ ë¶„ë„ í•  ìˆ˜ ìˆëŠ” ìŠ¤íŠ¸ë ˆì¹­', 'ì¹¨ëŒ€ì—ì„œ í•˜ëŠ” 5ë¶„ ìš´ë™'] },
    { id: 'traditional-remedy', name: 'í• ë¨¸ë‹ˆ ë¯¼ê°„ìš”ë²•', icon: 'ğŸŒ¿', description: 'ì „í†µ ê±´ê°•ë²•, ë¯¼ê°„ìš”ë²•, ìì—°ì¹˜ìœ ', blueOcean: 85, competition: 'ë‚®ìŒ', avgRevenue: '100ë§Œ~350ë§Œì›', reason: 'ìì—°ì£¼ì˜ ê±´ê°•ë²•ì— ëŒ€í•œ ê´€ì‹¬', sampleTopics: ['ì˜›ë‚  ì–´ë¨¸ë‹ˆê°€ í•´ì£¼ì…¨ë˜ ê°ê¸° ì¹˜ë£Œë²•', 'í• ë¨¸ë‹ˆì˜ ë¹„ë°€ ì•½ì´ˆ'] },
    { id: 'hospital-tips', name: 'ë³‘ì› ê¿€íŒ', icon: 'ğŸ¥', description: 'ì˜ë£Œë¹„ ì ˆì•½, ì¢‹ì€ ë³‘ì› ì°¾ê¸°, ì‹¤ë¹„ ì²­êµ¬', blueOcean: 87, competition: 'ë‚®ìŒ', avgRevenue: '150ë§Œ~500ë§Œì›', reason: 'ì‹¤ì§ˆì  ì˜ë£Œ ì •ë³´ì— ëŒ€í•œ ë†’ì€ ìˆ˜ìš”', sampleTopics: ['ì‹¤ë¹„ë³´í—˜ ì²­êµ¬ ì´ë ‡ê²Œ í•˜ì„¸ìš”', 'ëŒ€í•™ë³‘ì› ì˜ˆì•½ ì‰½ê²Œ í•˜ëŠ” ë²•', 'ì¢‹ì€ ì˜ì‚¬ ì°¾ëŠ” ê¸°ì¤€'] },
    { id: 'sleep-health', name: 'ìˆ˜ë©´ ê±´ê°•', icon: 'ğŸ˜´', description: 'ë¶ˆë©´ì¦ ê·¹ë³µ, ê¹Šì€ ì , ìˆ˜ë©´ íŒ¨í„´', blueOcean: 81, competition: 'ì¤‘ê°„', avgRevenue: '100ë§Œ~350ë§Œì›', reason: 'ë‚˜ì´ ë“¤ìˆ˜ë¡ ì‹¬í•´ì§€ëŠ” ìˆ˜ë©´ ë¬¸ì œ', sampleTopics: ['60ëŒ€ ë¶ˆë©´ì¦ ì´ë ‡ê²Œ ê³ ì³¤ì–´ìš”', 'ìƒˆë²½ì— ê¹¨ëŠ” ì´ìœ ', 'ìˆ™ë©´ ë“¤ê²Œ í•˜ëŠ” ìŠµê´€'] },
    { id: 'eye-health', name: 'ëˆˆ ê±´ê°•', icon: 'ğŸ‘ï¸', description: 'ë…¸ì•ˆ, ë°±ë‚´ì¥, ë…¹ë‚´ì¥ ì˜ˆë°©ê³¼ ê´€ë¦¬', blueOcean: 79, competition: 'ì¤‘ê°„', avgRevenue: '120ë§Œ~400ë§Œì›', reason: 'ë…¸ì•ˆì€ ì‹œë‹ˆì–´ ê³µí†µ ê´€ì‹¬ì‚¬', sampleTopics: ['ë°±ë‚´ì¥ ìˆ˜ìˆ  ì „ ê¼­ ì•Œì•„ì•¼ í•  ê²ƒ', 'ëˆˆ ê±´ê°• ì§€í‚¤ëŠ” ìŒì‹', 'ìŠ¤ë§ˆíŠ¸í°ì´ ëˆˆì— ë¯¸ì¹˜ëŠ” ì˜í–¥'] },
    { id: 'dental-care', name: 'ì¹˜ì•„ ê´€ë¦¬', icon: 'ğŸ¦·', description: 'ì„í”Œë€íŠ¸, í‹€ë‹ˆ, ì‡ëª¸ ê±´ê°•', blueOcean: 83, competition: 'ë‚®ìŒ', avgRevenue: '130ë§Œ~450ë§Œì›', reason: 'ì¹˜ê³¼ ë¹„ìš©ì´ ë†’ì•„ ì •ë³´ ìˆ˜ìš” ë§ìŒ', sampleTopics: ['ì„í”Œë€íŠ¸ vs í‹€ë‹ˆ í˜„ì‹¤ ë¹„êµ', 'ì‡ëª¸ ê±´ê°• íšŒë³µí•œ ë°©ë²•', 'ì¹˜ê³¼ ë¹„ìš© ì•„ë¼ëŠ” íŒ'] },

    // === ì¬í…Œí¬/ì‹¤ìš© ===
    { id: 'pension-secrets', name: 'ì—°ê¸ˆì˜ ë¹„ë°€', icon: 'ğŸ›ï¸', description: 'ê³µë¬´ì›/êµ°ì¸/êµì‚¬ ì—°ê¸ˆ, ìˆ¨ê²¨ì§„ í˜œíƒ', blueOcean: 88, competition: 'ë‚®ìŒ', avgRevenue: '200ë§Œ~600ë§Œì›', reason: 'ì—°ê¸ˆ ì •ë³´ì— ëŒ€í•œ ë†’ì€ ê´€ì‹¬', sampleTopics: ['ê³µë¬´ì›ì—°ê¸ˆ ìµœì í™” ì „ëµ', 'ì—°ê¸ˆ ë¶„í•  ë°›ëŠ” ë²•'] },
    { id: 'senior-jobs', name: 'ì‹œë‹ˆì–´ ì¼ìë¦¬', icon: 'ğŸ’¼', description: 'ì€í‡´ í›„ ì·¨ì—…, ì¬ì·¨ì—…, ë¶€ì—…', blueOcean: 86, competition: 'ë‚®ìŒ', avgRevenue: '100ë§Œ~350ë§Œì›', reason: 'í™œë™ì  ë…¸í›„ì— ëŒ€í•œ ê´€ì‹¬ ì¦ê°€', sampleTopics: ['60ëŒ€ì— ì‹œì‘í•œ ìƒˆ ì§ì—…', 'ì€í‡´ í›„ ì›” 100ë§Œì› ë²„ëŠ” ë²•', 'ë…¸ì¸ ì¼ìë¦¬ ì„¼í„° ì´ìš©ë²•'] },
    { id: 'inheritance-tax', name: 'ìƒì† ì ˆì„¸', icon: 'ğŸ’°', description: 'ìƒì†ì„¸, ì¦ì—¬ì„¸, ì¬ì‚° ì´ì „ ì „ëµ', blueOcean: 84, competition: 'ì¤‘ê°„', avgRevenue: '180ë§Œ~550ë§Œì›', reason: 'ì¬ì‚° ì´ì „ì— ëŒ€í•œ ë†’ì€ ê´€ì‹¬', sampleTopics: ['ìë…€ì—ê²Œ ì§‘ ë¬¼ë ¤ì£¼ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•', '10ì–µ ìƒì† ì„¸ê¸ˆ 0ì› ë§Œë“œëŠ” ë²•'] },
    { id: 'senior-youtube', name: 'ì‹œë‹ˆì–´ ìœ íŠœë²„', icon: 'ğŸ“¹', description: 'ìœ íŠœë¸Œ ì‹œì‘ë²•, ìˆ˜ìµí™”, ì½˜í…ì¸  ì œì‘', blueOcean: 90, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ìœ íŠœë¸Œ í•˜ê³  ì‹¶ì€ ì‹œë‹ˆì–´ ê¸‰ì¦', sampleTopics: ['70ëŒ€ì— ìœ íŠœë¸Œ ì‹œì‘í–ˆë”ë‹ˆ', 'ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ì˜ìƒ ë§Œë“œëŠ” ë²•', 'ì²« ìˆ˜ìµ ë°›ì€ ë‚ '] },
    { id: 'welfare-benefits', name: 'ë³µì§€ í˜œíƒ', icon: 'ğŸ', description: 'ë…¸ì¸ ë³µì§€, ì •ë¶€ ì§€ì›ê¸ˆ, í• ì¸ í˜œíƒ', blueOcean: 91, competition: 'ë‚®ìŒ', avgRevenue: '120ë§Œ~400ë§Œì›', reason: 'ëª°ë¼ì„œ ëª» ë°›ëŠ” í˜œíƒì´ ë§ìŒ', sampleTopics: ['60ì„¸ ë„˜ìœ¼ë©´ ë°›ì„ ìˆ˜ ìˆëŠ” í˜œíƒ', 'ê¸°ì´ˆì—°ê¸ˆ ë” ë°›ëŠ” ë°©ë²•', 'ë¬´ë£Œë¡œ ì´ìš©í•˜ëŠ” ê²ƒë“¤'] },

    // === í…Œí¬/ë””ì§€í„¸ ===
    { id: 'senior-tech', name: 'ì‹œë‹ˆì–´ í…Œí¬', icon: 'ğŸ“±', description: 'ìŠ¤ë§ˆíŠ¸í°, í‚¤ì˜¤ìŠ¤í¬, ë””ì§€í„¸ ë¦¬í„°ëŸ¬ì‹œ', blueOcean: 86, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ë””ì§€í„¸ ê²©ì°¨ í•´ì†Œì— ëŒ€í•œ ë‹ˆì¦ˆ', sampleTopics: ['ì¹´ì¹´ì˜¤í†¡ ì™„ì „ì •ë³µ', 'í‚¤ì˜¤ìŠ¤í¬ ë‘ë ¤ì›€ ê·¹ë³µí•˜ê¸°'] },
    { id: 'ai-for-seniors', name: 'AI í™œìš©ë²•', icon: 'ğŸ¤–', description: 'ChatGPT, AI ë„êµ¬ ì‰½ê²Œ ë°°ìš°ê¸°', blueOcean: 94, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '90ë§Œ~350ë§Œì›', reason: 'AI ì‹œëŒ€, ì‹œë‹ˆì–´ë„ ë°°ìš°ê³  ì‹¶ì–´í•¨', sampleTopics: ['ChatGPTë¡œ ì†ì£¼ ìˆ™ì œ ë„ì™€ì£¼ê¸°', 'AIì—ê²Œ ê±´ê°• ìƒë‹´í•˜ê¸°', '60ëŒ€ë„ ì‰½ê²Œ ì“°ëŠ” AI'] },
    { id: 'online-shopping', name: 'ì˜¨ë¼ì¸ ì‡¼í•‘', icon: 'ğŸ›’', description: 'ì¿ íŒ¡, ë„¤ì´ë²„ ì‡¼í•‘, ì•ˆì „ ê²°ì œ', blueOcean: 82, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'ì˜¨ë¼ì¸ ì‡¼í•‘ ë°°ìš°ê³  ì‹¶ì€ ì‹œë‹ˆì–´ ë§ìŒ', sampleTopics: ['ì¿ íŒ¡ìœ¼ë¡œ ì¥ë³´ëŠ” ë²•', 'ì‚¬ê¸° ì•ˆ ë‹¹í•˜ëŠ” ì‡¼í•‘ íŒ', 'ë¡œì¼“ë°°ì†¡ 200% í™œìš©í•˜ê¸°'] },
    { id: 'banking-app', name: 'ëª¨ë°”ì¼ ë±…í‚¹', icon: 'ğŸ§', description: 'ì¸í„°ë„·ë±…í‚¹, ì•± ì‚¬ìš©ë²•, ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°©', blueOcean: 85, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ê¸ˆìœµ ë””ì§€í„¸í™”ë¡œ í•„ìˆ˜ ìŠ¤í‚¬', sampleTopics: ['í† ìŠ¤ ì•± ì™„ì „ì •ë³µ', 'ë³´ì´ìŠ¤í”¼ì‹± 100% í”¼í•˜ëŠ” ë²•', 'ì´ì²´ ìˆ˜ìˆ˜ë£Œ 0ì›ìœ¼ë¡œ í•˜ê¸°'] },

    // === ì—­ì‚¬/ì¶”ì–µ ===
    { id: 'ancestor-story', name: 'ì¡°ìƒ ì´ì•¼ê¸°', icon: 'ğŸ¯', description: 'ì¡±ë³´, ê°€ë¬¸ ì—­ì‚¬, ì¡°ìƒë‹˜ë“¤ì˜ ì´ì•¼ê¸°', blueOcean: 93, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '60ë§Œ~200ë§Œì›', reason: 'ë¿Œë¦¬ì— ëŒ€í•œ ê´€ì‹¬ì´ ë†’ìŒ', sampleTopics: ['ìš°ë¦¬ ì§‘ì•ˆì˜ ìˆ¨ê²¨ì§„ ì—­ì‚¬', 'ì¡±ë³´ë¡œ ì°¾ì€ ë†€ë¼ìš´ ì¡°ìƒ'] },
    { id: 'war-memories', name: 'ì „ìŸ ê¸°ì–µ', icon: 'ğŸ–ï¸', description: 'í•œêµ­ì „ìŸ, ë² íŠ¸ë‚¨ ì°¸ì „, êµ°ìƒí™œ ì‹¤í™”', blueOcean: 87, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ì—­ì‚¬ì  ê°€ì¹˜, í¬ì†Œì„± ì¦ê°€', sampleTopics: ['ë² íŠ¸ë‚¨ ì°¸ì „ ìš©ì‚¬ì˜ ìˆ¨ê²¨ì§„ ì´ì•¼ê¸°', '6.25 í”¼ë‚œê¸¸ì—ì„œ ìƒê¸´ ì¼'] },
    { id: 'local-legend', name: 'ìš°ë¦¬ ë™ë„¤ ì „ì„¤', icon: 'ğŸ—¿', description: 'ì§€ì—­ë³„ ë¯¸ìŠ¤í„°ë¦¬, ì „ì„¤, ìˆ¨ê²¨ì§„ ëª…ì†Œ', blueOcean: 89, competition: 'ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'í–¥í† ì• ì™€ í˜¸ê¸°ì‹¬ ìê·¹', sampleTopics: ['ìš°ë¦¬ ë§ˆì„ì— ì „í•´ì˜¤ëŠ” ê·€ì‹  ì´ì•¼ê¸°', 'ë™ë„¤ ì–´ë¥´ì‹ ë§Œ ì•„ëŠ” ìˆ¨ì€ ëª…ì†Œ'] },
    { id: 'oldies-music', name: 'ì¶”ì–µì˜ ìŒì•…', icon: 'ğŸµ', description: '60-80ë…„ëŒ€ ê°€ìš”, íŒ, ìŒì•… ì† ì‚¬ì—°', blueOcean: 82, competition: 'ë‚®ìŒ', avgRevenue: '60ë§Œ~220ë§Œì›', reason: 'ìŒì•…ê³¼ ì¶”ì–µì˜ ì¡°í•©', sampleTopics: ['ì´ ë…¸ë˜ ë“¤ìœ¼ë©´ ëˆˆë¬¼ë‚˜ëŠ” ì´ìœ ', '70ë…„ëŒ€ ê°€ìˆ˜ë“¤ì˜ ìˆ¨ê²¨ì§„ ì´ì•¼ê¸°'] },
    { id: 'vintage-food', name: 'ì˜›ë‚  ìŒì‹', icon: 'ğŸš', description: '60-70ë…„ëŒ€ ìŒì‹, ìŠí˜€ì§„ ë ˆì‹œí”¼', blueOcean: 90, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '70ë§Œ~260ë§Œì›', reason: 'ìŒì‹ê³¼ ì¶”ì–µì˜ ê°•ë ¥í•œ ì¡°í•©', sampleTopics: ['70ë…„ëŒ€ ë„ì‹œë½ ë°˜ì°¬', 'ì‹œì¥ì—ì„œ ì‚¬ë¼ì§„ ìŒì‹ë“¤'] },
    { id: 'school-memories', name: 'í•™ì°½ì‹œì ˆ', icon: 'ğŸ«', description: 'ì˜›ë‚  í•™êµ, êµì‹¤ í’ê²½, ì„ ìƒë‹˜ ì´ì•¼ê¸°', blueOcean: 86, competition: 'ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'ëˆ„êµ¬ë‚˜ ê³µê°í•˜ëŠ” í•™ì°½ì‹œì ˆ ì¶”ì–µ', sampleTopics: ['60ë…„ëŒ€ í•™êµëŠ” ì´ë¬ìŠµë‹ˆë‹¤', 'ì„ ìƒë‹˜ê»˜ ë§ì•˜ë˜ ì´ì•¼ê¸°', 'ê¸‰ì‹ ì—†ë˜ ì‹œì ˆ ë„ì‹œë½'] },

    // === ê´€ê³„/ê°€ì¡± ===
    { id: 'grandchild-edu', name: 'ì†ì£¼ êµìœ¡', icon: 'ğŸ‘¶', description: 'ì†ì£¼ ëŒë´„, ìœ¡ì•„ íŠ¸ë Œë“œ, ì„¸ëŒ€ ê°„ ì†Œí†µ', blueOcean: 84, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'ì‹œë‹ˆì–´ì™€ ì Šì€ ë¶€ëª¨ ëª¨ë‘ ê´€ì‹¬', sampleTopics: ['ìš”ì¦˜ ìœ¡ì•„ ë”°ë¼ì¡ê¸°', 'ì†ì£¼ì™€ ì˜ ì§€ë‚´ëŠ” ë¹„ê²°'] },
    { id: 'couple-life', name: 'í™©í˜¼ ë¶€ë¶€', icon: 'ğŸ‘«', description: 'ì˜¤ë˜ëœ ë¶€ë¶€ ìƒí™œ, ê°±ë…„ê¸°, ë¶€ë¶€ ëŒ€í™”', blueOcean: 88, competition: 'ë‚®ìŒ', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ê²°í˜¼ 30-40ë…„ ì°¨ ë¶€ë¶€ ê³µê°', sampleTopics: ['40ë…„ í•¨ê»˜ ì‚¬ëŠ” ë¹„ê²°', 'ì•„ë‚´/ë‚¨í¸ì´ ë¯¸ì›Œì§ˆ ë•Œ', 'í™©í˜¼ ì´í˜¼ ë§‰ëŠ” ë²•'] },
    { id: 'adult-children', name: 'ì„±ì¸ ìë…€', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', description: 'ìë…€ì™€ì˜ ê´€ê³„, ë…ë¦½, ê²°í˜¼ ì••ë°•', blueOcean: 85, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'ìë…€ì™€ì˜ ê°ˆë“±ì€ ë³´í¸ì  ì£¼ì œ', sampleTopics: ['ê²°í˜¼ ì•ˆ í•˜ëŠ” ìë…€ ì–´ì©Œë‚˜', 'ë…ë¦½ ì•ˆ í•˜ëŠ” ìë…€ ëŒ€ì²˜ë²•', 'ìë…€ì—ê²Œ ì„œìš´í•  ë•Œ'] },
    { id: 'friend-making', name: 'ì¹œêµ¬ ì‚¬ê·€ê¸°', icon: 'ğŸ¤', description: 'ë…¸ë…„ì˜ ìš°ì •, ìƒˆ ì¹œêµ¬ ë§Œë“¤ê¸°', blueOcean: 87, competition: 'ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'ì‚¬íšŒì  ê´€ê³„ì˜ ì¤‘ìš”ì„± ì¸ì‹ ì¦ê°€', sampleTopics: ['60ëŒ€ì— ìƒˆ ì¹œêµ¬ ì‚¬ê·€ëŠ” ë²•', 'ë…¸ì¸ì • ì²« ë°©ë¬¸ê¸°', 'ì˜¨ë¼ì¸ ì¹œêµ¬ ë§Œë“¤ê¸°'] },

    // === ì·¨ë¯¸/ì—¬ê°€ ===
    { id: 'senior-travel', name: 'ì‹œë‹ˆì–´ ì—¬í–‰', icon: 'âœˆï¸', description: 'ì–´ë¥´ì‹  ë§ì¶¤ ì—¬í–‰ì§€, íš¨ë„ ê´€ê´‘', blueOcean: 78, competition: 'ì¤‘ê°„', avgRevenue: '100ë§Œ~380ë§Œì›', reason: 'ì—¬í–‰ ì½˜í…ì¸  ê´‘ê³  ë‹¨ê°€ ë†’ìŒ', sampleTopics: ['ë¬´ë¦ ì•„í”ˆ ë¶„ë„ í¸í•œ ì—¬í–‰ì§€', 'í˜¼ì ë– ë‚˜ëŠ” ì‹œë‹ˆì–´ ì—¬í–‰'] },
    { id: 'gardening', name: 'ë² ë€ë‹¤ í…ƒë°­', icon: 'ğŸŒ±', description: 'ì§‘ì—ì„œ ê¸°ë¥´ëŠ” ì±„ì†Œ, í™”ì´ˆ ê°€ê¾¸ê¸°', blueOcean: 81, competition: 'ì¤‘ê°„', avgRevenue: '60ë§Œ~220ë§Œì›', reason: 'íë§ê³¼ ì‹¤ìš©ì„± ëª¨ë‘ ì¶©ì¡±', sampleTopics: ['ë² ë€ë‹¤ì—ì„œ ìƒì¶” í‚¤ìš°ê¸°', 'í™”ë¶„ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë†ì‚¬', 'í‚¤ìš°ê¸° ì‰¬ìš´ ì±„ì†Œ 5ê°€ì§€'] },
    { id: 'fishing', name: 'ë‚šì‹œ ì…ë¬¸', icon: 'ğŸ£', description: 'ë°”ë‹¤ë‚šì‹œ, ë¯¼ë¬¼ë‚šì‹œ, ì¥ë¹„ ì¶”ì²œ', blueOcean: 79, competition: 'ì¤‘ê°„', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ì€í‡´ í›„ ì¸ê¸° ì·¨ë¯¸', sampleTopics: ['60ëŒ€ ë‚šì‹œ ì…ë¬¸ê¸°', 'ì´ˆë³´ ì¥ë¹„ ì´ê²ƒë§Œ ì‚¬ì„¸ìš”', 'ì¢‹ì€ ë‚šì‹œí„° ì°¾ëŠ” ë²•'] },
    { id: 'calligraphy', name: 'ì„œì˜ˆ/ìº˜ë¦¬', icon: 'âœï¸', description: 'ë¶“ê¸€ì”¨, ìº˜ë¦¬ê·¸ë˜í”¼, ì†ê¸€ì”¨', blueOcean: 83, competition: 'ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'ì •ì„œì  ì•ˆì •ì„ ì£¼ëŠ” ì·¨ë¯¸', sampleTopics: ['60ëŒ€ì— ì„œì˜ˆ ì‹œì‘í•˜ê¸°', 'ì˜ˆìœ ì†ê¸€ì”¨ ì“°ëŠ” ë²•', 'ë¶“íœ ì¶”ì²œ'] },
    { id: 'board-games', name: 'ë°”ë‘‘/ì¥ê¸°', icon: 'â™Ÿï¸', description: 'ë‘ë‡Œ ê²Œì„, ì˜¨ë¼ì¸ ëŒ€êµ­, í•™ìŠµë²•', blueOcean: 80, competition: 'ë‚®ìŒ', avgRevenue: '60ë§Œ~200ë§Œì›', reason: 'ì¹˜ë§¤ ì˜ˆë°©ê³¼ ì—°ê²°ë˜ì–´ ê´€ì‹¬ ë†’ìŒ', sampleTopics: ['ë°”ë‘‘ ì²˜ìŒ ë°°ìš°ê¸°', 'ì˜¨ë¼ì¸ìœ¼ë¡œ ë°”ë‘‘ ë‘ëŠ” ë²•', 'ë§¤ì¼ ë°”ë‘‘ ë‘ë©´ ìƒê¸°ëŠ” ë³€í™”'] },
    { id: 'pet-companion', name: 'ë°˜ë ¤ë™ë¬¼', icon: 'ğŸ•', description: 'ë…¸ë…„ì˜ ë°˜ë ¤ê²¬, ë°˜ë ¤ë¬˜, ì •ì„œì  êµê°', blueOcean: 84, competition: 'ì¤‘ê°„', avgRevenue: '80ë§Œ~300ë§Œì›', reason: 'ë°˜ë ¤ë™ë¬¼ì´ ì£¼ëŠ” ìœ„ì•ˆ', sampleTopics: ['60ëŒ€ì— ê°•ì•„ì§€ í‚¤ì›Œë„ ë ê¹Œ', 'ë…¸ì¸ê³¼ ë°˜ë ¤ë™ë¬¼ ê¶í•©', 'í˜¼ì ì‚¬ëŠ” ë¶„ê»˜ ì¶”ì²œí•˜ëŠ” ë°˜ë ¤ë™ë¬¼'] },

    // === ì¢…êµ/ëª…ìƒ ===
    { id: 'spiritual-life', name: 'ì˜ì  ìƒí™œ', icon: 'ğŸ™', description: 'ì‹ ì•™, ëª…ìƒ, ë§ˆìŒì˜ í‰í™”', blueOcean: 82, competition: 'ë‚®ìŒ', avgRevenue: '60ë§Œ~200ë§Œì›', reason: 'ë…¸ë…„ì˜ ì˜ì  ì¶”êµ¬', sampleTopics: ['ë‚˜ì´ ë“¤ìˆ˜ë¡ ì‹ ì•™ì´ ê¹Šì–´ì§„ ì´ìœ ', 'ë§¤ì¼ 10ë¶„ ëª…ìƒì˜ í˜', 'ë§ˆìŒì˜ í‰í™” ì°¾ê¸°'] },
    { id: 'temple-stay', name: 'í…œí”ŒìŠ¤í…Œì´', icon: 'ğŸ¯', description: 'ì ˆ ì²´í—˜, ëª…ìƒ ì—¬í–‰, ë§ˆìŒ ì¹˜ìœ ', blueOcean: 85, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'íë§ ì—¬í–‰ê³¼ ì˜ì  ì²´í—˜ ê²°í•©', sampleTopics: ['60ëŒ€ ì²« í…œí”ŒìŠ¤í…Œì´ í›„ê¸°', 'ì¡°ìš©íˆ ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” ì‹œê°„', 'ì¶”ì²œ ì‚¬ì°° ë¦¬ìŠ¤íŠ¸'] },

    // === ì§€ì—­ íŠ¹í™” ===
    { id: 'regional-dialect', name: 'ì‚¬íˆ¬ë¦¬ ì´ì•¼ê¸°', icon: 'ğŸ—£ï¸', description: 'ì§€ì—­ ë°©ì–¸, ì‚¬íˆ¬ë¦¬ í‘œí˜„, ì§€ì—­ ë¬¸í™”', blueOcean: 91, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'ì§€ì—­ ì •ì²´ì„±ê³¼ í–¥ìˆ˜ ìê·¹', sampleTopics: ['ì´ ì‚¬íˆ¬ë¦¬ ëœ» ì•„ì„¸ìš”?', 'ê²½ìƒë„ vs ì „ë¼ë„ ë§íˆ¬', 'ì„œìš¸ ì‚¬ëŒì´ ëª¨ë¥´ëŠ” í‘œí˜„'] },
    { id: 'market-tour', name: 'ì „í†µì‹œì¥', icon: 'ğŸª', description: 'ì¬ë˜ì‹œì¥ íƒë°©, ë§›ì§‘, ì¸ì‹¬', blueOcean: 84, competition: 'ë‚®ìŒ', avgRevenue: '60ë§Œ~220ë§Œì›', reason: 'ì „í†µì‹œì¥ì— ëŒ€í•œ í–¥ìˆ˜', sampleTopics: ['ì „êµ­ ìœ ëª… ì „í†µì‹œì¥ íˆ¬ì–´', 'ì‹œì¥ì—ì„œë§Œ ë§›ë³¼ ìˆ˜ ìˆëŠ” ê²ƒ', 'ì‚¬ë¼ì ¸ê°€ëŠ” ì‹œì¥ í’ê²½'] },

    // === ì‹œì‚¬/íŠ¸ë Œë“œ ===
    { id: 'news-analysis', name: 'ë‰´ìŠ¤ í•´ì„¤', icon: 'ğŸ“º', description: 'ì‹œì‚¬ ì´ìŠˆë¥¼ ì‹œë‹ˆì–´ ëˆˆë†’ì´ë¡œ', blueOcean: 77, competition: 'ì¤‘ê°„', avgRevenue: '90ë§Œ~320ë§Œì›', reason: 'ë³µì¡í•œ ë‰´ìŠ¤ë¥¼ ì‰½ê²Œ ì„¤ëª…', sampleTopics: ['ìš”ì¦˜ ê²½ì œ ë‰´ìŠ¤ ì‰½ê²Œ ì´í•´í•˜ê¸°', 'ë¶€ë™ì‚° ì •ì±… ë­ê°€ ë°”ë€Œì—ˆë‚˜', 'AI ì‹œëŒ€ ìš°ë¦¬ ì‚¶ ì–´ë–»ê²Œ ë³€í• ê¹Œ'] },
    { id: 'generation-gap', name: 'ì„¸ëŒ€ ì°¨ì´', icon: 'ğŸ”„', description: 'MZì„¸ëŒ€ ì´í•´, ì„¸ëŒ€ ê°„ ì†Œí†µ', blueOcean: 86, competition: 'ë‚®ìŒ', avgRevenue: '70ë§Œ~250ë§Œì›', reason: 'ì„¸ëŒ€ ê°ˆë“±ì— ëŒ€í•œ ê´€ì‹¬', sampleTopics: ['ìš”ì¦˜ ì Šì€ì´ë“¤ ì™œ ê·¸ëŸ´ê¹Œ', 'MZì„¸ëŒ€ ì´í•´í•˜ê¸°', 'ì„¸ëŒ€ ì°¨ì´ ì¤„ì´ëŠ” ëŒ€í™”ë²•'] },

    // === ìƒˆë¡œìš´ íŠ¸ë Œë“œ ===
    { id: 'silver-influencer', name: 'ì‹¤ë²„ ì¸í”Œë£¨ì–¸ì„œ', icon: 'â­', description: 'ì‹œë‹ˆì–´ SNS ìŠ¤íƒ€ê°€ ë˜ëŠ” ë²•', blueOcean: 93, competition: 'ë§¤ìš° ë‚®ìŒ', avgRevenue: '100ë§Œ~400ë§Œì›', reason: 'ì‹œë‹ˆì–´ ì¸í”Œë£¨ì–¸ì„œ ê¸‰ì¦', sampleTopics: ['ì¸ìŠ¤íƒ€ê·¸ë¨ ì‹œì‘í•˜ê¸°', 'í‹±í†¡ ë„ì „ê¸°', '70ëŒ€ ì¸í”Œë£¨ì–¸ì„œ ì¸í„°ë·°'] },
    { id: 'secondlife-startup', name: 'ì¸ìƒ 2ë§‰ ì°½ì—…', icon: 'ğŸš€', description: 'ì†Œê·œëª¨ ì°½ì—…, í”„ëœì°¨ì´ì¦ˆ, ì‚¬ì—… ì‹œì‘', blueOcean: 85, competition: 'ë‚®ìŒ', avgRevenue: '120ë§Œ~400ë§Œì›', reason: 'í™œë™ì  ë…¸í›„ë¥¼ ì›í•˜ëŠ” ì‹œë‹ˆì–´', sampleTopics: ['60ëŒ€ì— ì¹´í˜ ì°½ì—…í•œ ì´ì•¼ê¸°', 'ì†Œìë³¸ ì°½ì—… ì•„ì´í…œ', 'ì‹¤íŒ¨ ì—†ëŠ” ì°½ì—… ê°€ì´ë“œ'] },
    { id: 'eco-senior', name: 'ì¹œí™˜ê²½ ì‹¤ì²œ', icon: 'â™»ï¸', description: 'í™˜ê²½ë³´í˜¸, ì œë¡œì›¨ì´ìŠ¤íŠ¸, ì§€êµ¬ ì‚´ë¦¬ê¸°', blueOcean: 83, competition: 'ë‚®ìŒ', avgRevenue: '50ë§Œ~180ë§Œì›', reason: 'ì†ì£¼ ì„¸ëŒ€ë¥¼ ìœ„í•œ í™˜ê²½ ì˜ì‹', sampleTopics: ['ì†ì£¼ì—ê²Œ ë¬¼ë ¤ì¤„ ì§€êµ¬', 'í”Œë¼ìŠ¤í‹± ì—†ì´ ì‚´ê¸°', 'ì‹œë‹ˆì–´ ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë„ì „'] }
];

// === ë™ì  ì¹´í…Œê³ ë¦¬ ìƒì„±ì„ ìœ„í•œ ì¡°í•© ë°ì´í„° ===
const categoryModifiers = {
    prefixes: ['60ëŒ€', '70ëŒ€', 'ì€í‡´ í›„', 'í˜¼ìì„œë„', 'ëˆ ì•ˆ ë“œëŠ”', 'ë§¤ì¼ í•˜ëŠ”', 'ì²˜ìŒ ë°°ìš°ëŠ”', 'ì‰½ê²Œ í•˜ëŠ”'],
    suffixes: ['ë„ì „ê¸°', 'ê¿€íŒ', 'ì²´í—˜ê¸°', 'í˜„ì‹¤', 'ë¹„ë°€', 'ë…¸í•˜ìš°', 'ì…ë¬¸', 'ê°€ì´ë“œ'],
    trends: ['AI', 'ìœ íŠœë¸Œ', 'ê±´ê°•', 'ì¬í…Œí¬', 'ì—¬í–‰', 'ì·¨ë¯¸', 'ê°€ì¡±', 'ìŒì‹', 'ìš´ë™', 'ëª…ìƒ']
};

// ì¶”ê°€ëœ ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ (localStorageì—ì„œ ë¡œë“œ)
let customCategories = JSON.parse(localStorage.getItem('senior_custom_categories') || '[]');
let discoveredCategoryList = [];

// ===== ë‹ˆì¹˜ ì£¼ì œ ë°ì´í„°ë² ì´ìŠ¤ =====
const topicsDatabase = {
    story: [
        {
            id: 1,
            title: "6070 ì²«ì‚¬ë‘, ê·¸ ì‹œì ˆ ìš°ë¦¬ê°€ ì‚¬ë‘í–ˆë˜ ë°©ì‹",
            icon: "ğŸ’•",
            reason: "ì²«ì‚¬ë‘ì€ ëˆ„êµ¬ì—ê²Œë‚˜ íŠ¹ë³„í•œ ê¸°ì–µì…ë‹ˆë‹¤. íŠ¹íˆ 60-70ëŒ€ì—ê²Œ 6070ë…„ëŒ€ ì²«ì‚¬ë‘ì€ ìŠ¤ë§ˆíŠ¸í° ì—†ì´ í¸ì§€ë¡œ ë§ˆìŒì„ ì „í•˜ë˜ ì•„ë‚ ë¡œê·¸ ê°ì„±ì´ ë¬»ì–´ìˆì–´ ê°•í•œ ê³µê°ì„ ìœ ë°œí•©ë‹ˆë‹¤.",
            targetAudience: "55-70ì„¸, ê³¼ê±° ì¶”ì–µì— í–¥ìˆ˜ë¥¼ ëŠë¼ëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì²«ì‚¬ë‘", "6070ë…„ëŒ€", "ëŸ¬ë¸Œë ˆí„°", "ì¶”ì–µ", "ì²­ì¶˜ì‹œì ˆ"],
            blueOcean: 87,
            competition: "ë‚®ìŒ",
            views: "15ë§Œ~30ë§Œ",
            revenue: "60ë§Œ~150ë§Œì›",
            growth: "ìƒìŠ¹ì„¸"
        },
        {
            id: 2,
            title: "IMF ë•Œ ìš°ë¦¬ ê°€ì¡±ì´ ì‚´ì•„ë‚¨ì€ ë°©ë²•",
            icon: "ğŸ’ª",
            reason: "1997ë…„ IMF ìœ„ê¸°ëŠ” ëª¨ë“  í•œêµ­ì¸ì—ê²Œ íŠ¸ë¼ìš°ë§ˆì´ì ê·¹ë³µì˜ ê¸°ì–µì…ë‹ˆë‹¤. ì‹¤ì œ ê²½í—˜ë‹´ì€ ì Šì€ ì„¸ëŒ€ì—ê²Œë„ êµí›ˆì´ ë˜ì–´ í­ë„“ì€ ì‹œì²­ì¸µì„ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            targetAudience: "45-65ì„¸, IMFë¥¼ ì§ì ‘ ê²½í—˜í•œ ì„¸ëŒ€",
            keywords: ["IMF", "ê²½ì œìœ„ê¸°", "ìƒì¡´ê¸°", "ê°€ì¡±", "ê·¹ë³µ"],
            blueOcean: 82,
            competition: "ë‚®ìŒ",
            views: "20ë§Œ~50ë§Œ",
            revenue: "80ë§Œ~250ë§Œì›",
            growth: "ì•ˆì •ì "
        },
        {
            id: 3,
            title: "êµ°ëŒ€ì—ì„œ ìˆì—ˆë˜ ë¯¿ê¸° í˜ë“  ì‹¤í™”",
            icon: "ğŸ–ï¸",
            reason: "êµ° ë³µë¬´ ê²½í—˜ì€ í•œêµ­ ë‚¨ì„±ì˜ ê³µí†µ ê¸°ì–µì…ë‹ˆë‹¤. íŠ¹íˆ 70-80ë…„ëŒ€ êµ°ëŒ€ ì´ì•¼ê¸°ëŠ” ì§€ê¸ˆê³¼ ë§ì´ ë‹¬ë¼ ì Šì€ ì„¸ëŒ€ë„ í˜¸ê¸°ì‹¬ì„ ê°–ìŠµë‹ˆë‹¤.",
            targetAudience: "50-70ì„¸ ë‚¨ì„±, êµ° ê²½í—˜ ê³µìœ ë¥¼ ì¢‹ì•„í•˜ëŠ” ì‹œì²­ì",
            keywords: ["êµ°ëŒ€", "í›ˆë ¨ì†Œ", "ì „ìš°", "ì‹¤í™”", "ì¶”ì–µ"],
            blueOcean: 79,
            competition: "ì¤‘ê°„",
            views: "25ë§Œ~60ë§Œ",
            revenue: "100ë§Œ~300ë§Œì›",
            growth: "ìƒìŠ¹ì„¸"
        },
        {
            id: 4,
            title: "ë¶€ëª¨ë‹˜ê»˜ ëë‚´ ë§ì”€ë“œë¦¬ì§€ ëª»í•œ ì´ì•¼ê¸°",
            icon: "ğŸ˜¢",
            reason: "ëŒì•„ê°€ì‹  ë¶€ëª¨ë‹˜ê»˜ ì „í•˜ì§€ ëª»í•œ ë§ì€ ëˆ„êµ¬ì—ê²Œë‚˜ ìˆìŠµë‹ˆë‹¤. ê¹Šì€ ê³µê°ê³¼ ê°ë™ì„ ì£¼ë©° ëŒ“ê¸€ ì°¸ì—¬ìœ¨ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "50-70ì„¸, ë¶€ëª¨ë‹˜ì„ ì—¬ìœ ì‹œë‹ˆì–´",
            keywords: ["ë¶€ëª¨ë‹˜", "íš¨ë„", "í›„íšŒ", "ê·¸ë¦¬ì›€", "ê°ë™"],
            blueOcean: 91,
            competition: "ë§¤ìš° ë‚®ìŒ",
            views: "30ë§Œ~80ë§Œ",
            revenue: "120ë§Œ~400ë§Œì›",
            growth: "ê¸‰ìƒìŠ¹"
        },
        {
            id: 5,
            title: "ìƒˆë§ˆì„ìš´ë™ ë•Œ ìš°ë¦¬ ë§ˆì„ì— ìƒê¸´ ì¼",
            icon: "ğŸ˜ï¸",
            reason: "70ë…„ëŒ€ ìƒˆë§ˆì„ìš´ë™ì€ í•œêµ­ ê·¼ëŒ€í™”ì˜ ìƒì§•ì…ë‹ˆë‹¤. ì§ì ‘ ê²½í—˜í•œ ì„¸ëŒ€ì˜ ìƒìƒí•œ ì´ì•¼ê¸°ëŠ” ì—­ì‚¬ì  ê°€ì¹˜ë„ ìˆì–´ ì§€ì†ì ì¸ ê´€ì‹¬ì„ ë°›ìŠµë‹ˆë‹¤.",
            targetAudience: "60-80ì„¸, ìƒˆë§ˆì„ìš´ë™ ê²½í—˜ ì„¸ëŒ€",
            keywords: ["ìƒˆë§ˆì„ìš´ë™", "70ë…„ëŒ€", "ê·¼ëŒ€í™”", "ë§ˆì„", "ì¶”ì–µ"],
            blueOcean: 94,
            competition: "ë§¤ìš° ë‚®ìŒ",
            views: "10ë§Œ~25ë§Œ",
            revenue: "40ë§Œ~100ë§Œì›",
            growth: "í‹ˆìƒˆì‹œì¥"
        }
    ],
    health: [
        {
            id: 10,
            title: "ë¬´ë¦ í†µì¦ 10ë…„, í•˜ë£¨ 5ë¶„ìœ¼ë¡œ í•´ê²°í•œ ë°©ë²•",
            icon: "ğŸ¦µ",
            reason: "ë¬´ë¦ í†µì¦ì€ ì‹œë‹ˆì–´ì˜ ê°€ì¥ í”í•œ ê±´ê°• ë¬¸ì œì…ë‹ˆë‹¤. ì‹¤ì œ ê²½í—˜ ê¸°ë°˜ í•´ê²°ì±…ì€ ê´‘ê³  ìˆ˜ìµë„ ë†’ê³  ì‹œì²­ ì§€ì†ì‹œê°„ì´ ê¹ë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, ê´€ì ˆ í†µì¦ì„ ê²ªëŠ” ì‹œë‹ˆì–´",
            keywords: ["ë¬´ë¦í†µì¦", "ê´€ì ˆ", "ìŠ¤íŠ¸ë ˆì¹­", "ê±´ê°•ê´€ë¦¬", "ìš´ë™"],
            blueOcean: 76,
            competition: "ì¤‘ê°„",
            views: "40ë§Œ~100ë§Œ",
            revenue: "160ë§Œ~500ë§Œì›",
            growth: "ì•ˆì •ì  ìƒìŠ¹"
        },
        {
            id: 11,
            title: "ë‹¹ë‡¨ ì§„ë‹¨ í›„ ì•½ ì—†ì´ ì •ìƒìˆ˜ì¹˜ ë§Œë“  ì‹ë‹¨",
            icon: "ğŸ",
            reason: "ë‹¹ë‡¨ëŠ” í•œêµ­ ì‹œë‹ˆì–´ì˜ êµ­ë¯¼ë³‘ì…ë‹ˆë‹¤. ì•½ ì—†ì´ ê´€ë¦¬í•˜ëŠ” ë…¸í•˜ìš°ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ë§¤ìš° ë†’ê³ , ê±´ê°•ì‹í’ˆ ê´‘ê³  ë‹¨ê°€ê°€ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "50-70ì„¸, ë‹¹ë‡¨ í™˜ì ë˜ëŠ” ì „ë‹¨ê³„",
            keywords: ["ë‹¹ë‡¨", "í˜ˆë‹¹ê´€ë¦¬", "ì‹ë‹¨", "ê±´ê°•ì‹", "ìì—°ì¹˜ìœ "],
            blueOcean: 72,
            competition: "ì¤‘ìƒ",
            views: "50ë§Œ~150ë§Œ",
            revenue: "200ë§Œ~750ë§Œì›",
            growth: "í­ë°œì "
        },
        {
            id: 12,
            title: "ì ì´ ì•ˆ ì˜¤ëŠ” ë°¤, ì˜ì‚¬ê°€ ëª°ë˜ ì“°ëŠ” ìˆ˜ë©´ë²•",
            icon: "ğŸ˜´",
            reason: "ë¶ˆë©´ì¦ì€ ë‚˜ì´ê°€ ë“¤ìˆ˜ë¡ ì‹¬í•´ì§€ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. 'ì˜ì‚¬ê°€ ì“°ëŠ”'ì´ë¼ëŠ” ê¶Œìœ„ì™€ ì‹¤ìš©ì„±ì´ ê²°í•©ë˜ì–´ í´ë¦­ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, ìˆ˜ë©´ ë¬¸ì œë¥¼ ê²ªëŠ” ì‹œë‹ˆì–´",
            keywords: ["ë¶ˆë©´ì¦", "ìˆ˜ë©´", "ìˆ™ë©´", "ê±´ê°•", "ë°¤"],
            blueOcean: 81,
            competition: "ë‚®ìŒ",
            views: "35ë§Œ~80ë§Œ",
            revenue: "140ë§Œ~400ë§Œì›",
            growth: "ìƒìŠ¹ì„¸"
        },
        {
            id: 13,
            title: "ê³ í˜ˆì•• 20ë…„, ì´ê²ƒë§Œ ë°”ê¿¨ë”ë‹ˆ ì •ìƒìœ¼ë¡œ",
            icon: "â¤ï¸",
            reason: "ê³ í˜ˆì••ì€ ë‹¹ë‡¨ì™€ í•¨ê»˜ ì‹œë‹ˆì–´ ê±´ê°•ì˜ ì–‘ëŒ€ ì‚°ë§¥ì…ë‹ˆë‹¤. ì‹¤ì œ ê²½í—˜ë‹´ í˜•ì‹ì˜ ì½˜í…ì¸ ëŠ” ì‹ ë¢°ë„ê°€ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, ê³ í˜ˆì•• í™˜ì",
            keywords: ["ê³ í˜ˆì••", "í˜ˆì••ê´€ë¦¬", "ìƒí™œìŠµê´€", "ê±´ê°•", "ê°œì„ "],
            blueOcean: 74,
            competition: "ì¤‘ê°„",
            views: "45ë§Œ~110ë§Œ",
            revenue: "180ë§Œ~550ë§Œì›",
            growth: "ì•ˆì •ì "
        },
        {
            id: 14,
            title: "ì¹˜ë§¤ ì˜ˆë°©, ë‡Œê³¼í•™ìê°€ ë§¤ì¼ í•˜ëŠ” 5ê°€ì§€",
            icon: "ğŸ§ ",
            reason: "ì¹˜ë§¤ëŠ” ì‹œë‹ˆì–´ ìµœëŒ€ì˜ ê³µí¬ì…ë‹ˆë‹¤. ì˜ˆë°©ë²•ì— ëŒ€í•œ ê´€ì‹¬ì´ ê·¹ë„ë¡œ ë†’ê³ , ê´€ë ¨ ê´‘ê³  ë‹¨ê°€ë„ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, ì¹˜ë§¤ë¥¼ ê±±ì •í•˜ëŠ” ì‹œë‹ˆì–´ì™€ ìë…€",
            keywords: ["ì¹˜ë§¤ì˜ˆë°©", "ë‡Œê±´ê°•", "ì¸ì§€ë ¥", "ê¸°ì–µë ¥", "ë…¸í™”ë°©ì§€"],
            blueOcean: 69,
            competition: "ì¤‘ìƒ",
            views: "60ë§Œ~200ë§Œ",
            revenue: "240ë§Œ~1000ë§Œì›",
            growth: "í­ë°œì "
        }
    ],
    history: [
        {
            id: 20,
            title: "ì¡°ì„ ì‹œëŒ€ ì™•ì´ ìˆ¨ê¸´ ë¹„ë°€ ì°½ê³ ê°€ ë°œê²¬ëë‹¤",
            icon: "ğŸ‘‘",
            reason: "ë¯¸ìŠ¤í„°ë¦¬ì™€ ì—­ì‚¬ì˜ ì¡°í•©ì€ ê°•ë ¥í•œ ê´€ì‹¬ ìœ ë°œ ìš”ì†Œì…ë‹ˆë‹¤. ì‹œë‹ˆì–´ì¸µì€ ì—­ì‚¬ì— ëŒ€í•œ ê´€ì‹¬ì´ ë†’ê³  ì‹œì²­ ì‹œê°„ì´ ê¹ë‹ˆë‹¤.",
            targetAudience: "50-75ì„¸, ì—­ì‚¬ì— ê´€ì‹¬ ìˆëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì¡°ì„ ì‹œëŒ€", "ì—­ì‚¬ë¯¸ìŠ¤í„°ë¦¬", "ì™•", "ë¹„ë°€", "ë°œê²¬"],
            blueOcean: 83,
            competition: "ë‚®ìŒ",
            views: "25ë§Œ~70ë§Œ",
            revenue: "100ë§Œ~350ë§Œì›",
            growth: "ì•ˆì •ì "
        },
        {
            id: 21,
            title: "6.25 ë•Œ í• ë¨¸ë‹ˆê°€ ê²ªì€ ë¯¿ê¸° í˜ë“  ì‹¤í™”",
            icon: "ğŸ—ï¸",
            reason: "í•œêµ­ì „ìŸ ì´ì•¼ê¸°ëŠ” ì—­ì‚¬ì  ê°€ì¹˜ì™€ ê°ë™ì„ ë™ì‹œì— ì¤ë‹ˆë‹¤. íŠ¹íˆ ê°€ì¡± ì‚¬ì—°ì€ ê³µê°ì„ ìœ ë°œí•©ë‹ˆë‹¤.",
            targetAudience: "55-80ì„¸, ì „ìŸ ê²½í—˜ ì„¸ëŒ€ì™€ ê·¸ ìë…€",
            keywords: ["6.25", "í•œêµ­ì „ìŸ", "ì‹¤í™”", "ìƒì¡´", "ê°€ì¡±"],
            blueOcean: 88,
            competition: "ë§¤ìš° ë‚®ìŒ",
            views: "20ë§Œ~60ë§Œ",
            revenue: "80ë§Œ~300ë§Œì›",
            growth: "í‹ˆìƒˆì‹œì¥"
        },
        {
            id: 22,
            title: "ì¼ì œê°•ì ê¸° ë…ë¦½ìš´ë™ê°€ë“¤ì˜ ìˆ¨ê²¨ì§„ ì•”í˜¸",
            icon: "ğŸ”",
            reason: "ë…ë¦½ìš´ë™ì‚¬ì— ë¯¸ìŠ¤í„°ë¦¬ ìš”ì†Œë¥¼ ë”í•˜ë©´ êµìœ¡ì ì´ë©´ì„œë„ í¥ë¯¸ë¡œìš´ ì½˜í…ì¸ ê°€ ë©ë‹ˆë‹¤. ê´‘ë³µì ˆ ë“± ì‹œì¦Œ ì´ìŠˆì™€ ì—°ê³„ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            targetAudience: "45-75ì„¸, ì—­ì‚¬ì— ê´€ì‹¬ ìˆëŠ” ì‹œì²­ì",
            keywords: ["ì¼ì œê°•ì ê¸°", "ë…ë¦½ìš´ë™", "ì•”í˜¸", "ì—­ì‚¬", "ë¹„ë°€"],
            blueOcean: 86,
            competition: "ë‚®ìŒ",
            views: "18ë§Œ~50ë§Œ",
            revenue: "72ë§Œ~250ë§Œì›",
            growth: "ì‹œì¦Œì„± ìƒìŠ¹"
        },
        {
            id: 23,
            title: "ê³ ë ¤ì‹œëŒ€ ë°¤ì—ë§Œ ì—´ë¦¬ë˜ ë¹„ë°€ ì‹œì¥ì˜ ì •ì²´",
            icon: "ğŸŒ™",
            reason: "ì˜ ì•Œë ¤ì§€ì§€ ì•Šì€ ì—­ì‚¬ì  ì‚¬ì‹¤ì€ í˜¸ê¸°ì‹¬ì„ ìê·¹í•©ë‹ˆë‹¤. ì•¼ë‹´ ìŠ¤íƒ€ì¼ë¡œ í’€ì–´ê°€ë©´ ì‹œì²­ ì§€ì†ì‹œê°„ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.",
            targetAudience: "50-70ì„¸, ì•¼ë‹´ê³¼ ì—­ì‚¬ë¥¼ ì¢‹ì•„í•˜ëŠ” ì‹œë‹ˆì–´",
            keywords: ["ê³ ë ¤ì‹œëŒ€", "ì•¼ì‹œì¥", "ì—­ì‚¬", "ë¹„ë°€", "ì•¼ë‹´"],
            blueOcean: 92,
            competition: "ë§¤ìš° ë‚®ìŒ",
            views: "12ë§Œ~35ë§Œ",
            revenue: "48ë§Œ~175ë§Œì›",
            growth: "ë¸”ë£¨ì˜¤ì…˜"
        },
        {
            id: 24,
            title: "ì¡°ì„  ìµœê³ ì˜ ëª…ì˜ê°€ ë‚¨ê¸´ ê±´ê°• ë¹„ë²•ì„œ",
            icon: "ğŸ“š",
            reason: "ì—­ì‚¬ì™€ ê±´ê°•ì˜ ê²°í•©ì€ ì‹œë‹ˆì–´ì¸µì—ê²Œ ì´ì¤‘ìœ¼ë¡œ ì–´í•„í•©ë‹ˆë‹¤. í—ˆì¤€, ë™ì˜ë³´ê° ë“± ìµìˆ™í•œ ì†Œì¬ì™€ ì—°ê²° ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, ê±´ê°•ê³¼ ì—­ì‚¬ ëª¨ë‘ ê´€ì‹¬ ìˆëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì¡°ì„ ", "ëª…ì˜", "ê±´ê°•ë¹„ë²•", "í•œì˜í•™", "ë™ì˜ë³´ê°"],
            blueOcean: 85,
            competition: "ë‚®ìŒ",
            views: "22ë§Œ~55ë§Œ",
            revenue: "88ë§Œ~275ë§Œì›",
            growth: "ì•ˆì •ì "
        }
    ],
    finance: [
        {
            id: 30,
            title: "êµ­ë¯¼ì—°ê¸ˆ, ì´ë ‡ê²Œ ë°›ìœ¼ë©´ ì›” 50ë§Œì› ë” ë°›ëŠ”ë‹¤",
            icon: "ğŸ’µ",
            reason: "ì—°ê¸ˆì€ ì‹œë‹ˆì–´ì˜ ê°€ì¥ í° ê´€ì‹¬ì‚¬ì…ë‹ˆë‹¤. ì‹¤ì§ˆì ì¸ í˜œíƒ ì •ë³´ëŠ” ì €ì¥ê³¼ ê³µìœ ê°€ ë§ì•„ ì•Œê³ ë¦¬ì¦˜ì— ìœ ë¦¬í•©ë‹ˆë‹¤.",
            targetAudience: "55-70ì„¸, ì—°ê¸ˆ ìˆ˜ë ¹ ì˜ˆì •ì ë˜ëŠ” ìˆ˜ë ¹ì",
            keywords: ["êµ­ë¯¼ì—°ê¸ˆ", "ì—°ê¸ˆìˆ˜ë ¹", "ë…¸í›„ìê¸ˆ", "ì¬í…Œí¬", "í˜œíƒ"],
            blueOcean: 71,
            competition: "ì¤‘ìƒ",
            views: "50ë§Œ~150ë§Œ",
            revenue: "200ë§Œ~750ë§Œì›",
            growth: "ì•ˆì •ì  ìƒìŠ¹"
        },
        {
            id: 31,
            title: "ì€í‡´ í›„ ì›” 200ë§Œì› ë§Œë“œëŠ” ê°€ì¥ ì•ˆì „í•œ ë°©ë²•",
            icon: "ğŸ¦",
            reason: "ì•ˆì „í•œ ìˆ˜ìµì— ëŒ€í•œ ë‹ˆì¦ˆëŠ” ì‹œë‹ˆì–´ì¸µì—ì„œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. êµ¬ì²´ì ì¸ ê¸ˆì•¡ì´ í¬í•¨ëœ ì œëª©ì€ í´ë¦­ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "55-70ì„¸, ì€í‡´ ì¤€ë¹„ ë˜ëŠ” ì€í‡´í•œ ì‹œë‹ˆì–´",
            keywords: ["ì€í‡´", "ì›”ìˆ˜ìµ", "ì•ˆì „íˆ¬ì", "íŒ¨ì‹œë¸Œì¸ì»´", "ë…¸í›„"],
            blueOcean: 68,
            competition: "ì¤‘ìƒ",
            views: "40ë§Œ~120ë§Œ",
            revenue: "160ë§Œ~600ë§Œì›",
            growth: "ìƒìŠ¹ì„¸"
        },
        {
            id: 32,
            title: "60ëŒ€ê°€ ì ˆëŒ€ í•˜ë©´ ì•ˆ ë˜ëŠ” ì¬í…Œí¬ 3ê°€ì§€",
            icon: "âš ï¸",
            reason: "'í•˜ë©´ ì•ˆ ë˜ëŠ”'ì´ë¼ëŠ” ê²½ê³ ì„± ì œëª©ì€ í´ë¦­ë¥ ì´ ë†’ìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ í”¼í•´ ì‚¬ë¡€ê°€ ë§ì•„ ê³µê°ì„ ì–»ìŠµë‹ˆë‹¤.",
            targetAudience: "55-70ì„¸, ì¬í…Œí¬ì— ê´€ì‹¬ ìˆëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì¬í…Œí¬", "íˆ¬ìì£¼ì˜", "60ëŒ€", "í”¼í•´ë°©ì§€", "ê¸ˆìœµì‚¬ê¸°"],
            blueOcean: 78,
            competition: "ë‚®ìŒ",
            views: "35ë§Œ~90ë§Œ",
            revenue: "140ë§Œ~450ë§Œì›",
            growth: "ê¸‰ìƒìŠ¹"
        },
        {
            id: 33,
            title: "ë¶€ëª¨ë‹˜ ì¬ì‚°, ìë…€ì—ê²Œ ì´ë ‡ê²Œ ë„˜ê²¨ì•¼ ì„¸ê¸ˆ 0ì›",
            icon: "ğŸ ",
            reason: "ìƒì†/ì¦ì—¬ëŠ” ì‹œë‹ˆì–´ì™€ ê·¸ ìë…€ ëª¨ë‘ ê´€ì‹¬ ìˆëŠ” ì£¼ì œì…ë‹ˆë‹¤. ì„¸ê¸ˆ ì ˆì•½ íŒì€ ì €ì¥ë¥ ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸ ì‹œë‹ˆì–´ì™€ 40-55ì„¸ ìë…€",
            keywords: ["ìƒì†", "ì¦ì—¬", "ì ˆì„¸", "ì¬ì‚°ì´ì „", "ì„¸ê¸ˆ"],
            blueOcean: 73,
            competition: "ì¤‘ê°„",
            views: "45ë§Œ~130ë§Œ",
            revenue: "180ë§Œ~650ë§Œì›",
            growth: "ì•ˆì •ì "
        },
        {
            id: 34,
            title: "70ëŒ€ ì–´ë¥´ì‹ ì´ ì›”ì„¸ë¡œ ì›” 300ë§Œì› ë²„ëŠ” ë¹„ê²°",
            icon: "ğŸ˜ï¸",
            reason: "ë¶€ë™ì‚° ì„ëŒ€ ìˆ˜ì…ì€ ì‹œë‹ˆì–´ì˜ ë¡œë§ì…ë‹ˆë‹¤. ì‹¤ì œ ì„±ê³µ ì‚¬ë¡€ëŠ” ì‹ ë¢°ë„ì™€ ê´€ì‹¬ë„ê°€ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, ë¶€ë™ì‚°ì— ê´€ì‹¬ ìˆëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì›”ì„¸", "ë¶€ë™ì‚°", "ì„ëŒ€ìˆ˜ìµ", "70ëŒ€", "ë…¸í›„ìˆ˜ì…"],
            blueOcean: 75,
            competition: "ì¤‘ê°„",
            views: "30ë§Œ~85ë§Œ",
            revenue: "120ë§Œ~425ë§Œì›",
            growth: "ìƒìŠ¹ì„¸"
        }
    ],
    hobby: [
        {
            id: 40,
            title: "ì†¡í•´ ì„ ìƒë‹˜ì´ 100ì„¸ê¹Œì§€ ì‚¬ë‘ë°›ì€ ë¹„ê²°",
            icon: "ğŸ¤",
            reason: "ì†¡í•´ì™€ ê°™ì€ êµ­ë¯¼ì  ì¸ë¬¼ì— ëŒ€í•œ ê´€ì‹¬ì€ ë†’ìŠµë‹ˆë‹¤. íŠ¸ë¡œíŠ¸ì™€ ì—°ê²°ë˜ì–´ ì‹œë‹ˆì–´ì¸µì˜ ê°•í•œ ê³µê°ì„ ìœ ë°œí•©ë‹ˆë‹¤.",
            targetAudience: "55-80ì„¸, íŠ¸ë¡œíŠ¸ë¥¼ ì¢‹ì•„í•˜ëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì†¡í•´", "íŠ¸ë¡œíŠ¸", "ì¥ìˆ˜ë¹„ê²°", "êµ­ë¯¼MC", "ì¸ìƒ"],
            blueOcean: 77,
            competition: "ë‚®ìŒ",
            views: "30ë§Œ~80ë§Œ",
            revenue: "120ë§Œ~400ë§Œì›",
            growth: "ì•ˆì •ì "
        },
        {
            id: 41,
            title: "60ëŒ€ê°€ ê¼­ ê°€ë´ì•¼ í•  ê±·ê¸° ì¢‹ì€ ìˆ¨ì€ ëª…ì†Œ",
            icon: "ğŸ¥¾",
            reason: "ë“±ì‚°ê³¼ ê±·ê¸°ëŠ” ì‹œë‹ˆì–´ì˜ ìµœê³  ì·¨ë¯¸ì…ë‹ˆë‹¤. ìˆ¨ì€ ëª…ì†ŒëŠ” ìƒˆë¡œì›€ê³¼ ì‹¤ìš©ì„±ì„ ëª¨ë‘ ì œê³µí•©ë‹ˆë‹¤.",
            targetAudience: "55-70ì„¸, ê±·ê¸°ì™€ ì—¬í–‰ì„ ì¦ê¸°ëŠ” ì‹œë‹ˆì–´",
            keywords: ["ê±·ê¸°ì—¬í–‰", "ëª…ì†Œ", "60ëŒ€", "ê±´ê°•ì‚°ì±…", "ì—¬í–‰"],
            blueOcean: 80,
            competition: "ë‚®ìŒ",
            views: "25ë§Œ~65ë§Œ",
            revenue: "100ë§Œ~325ë§Œì›",
            growth: "ì‹œì¦Œì„±"
        },
        {
            id: 42,
            title: "ì–´ë¨¸ë‹ˆê°€ í•´ì£¼ì‹œë˜ ê·¸ ìŒì‹, ë ˆì‹œí”¼ ë³µì›",
            icon: "ğŸ²",
            reason: "ë…¸ìŠ¤íƒ¤ì§€ì–´ì™€ ì‹¤ìš©ì„±ì˜ ì™„ë²½í•œ ì¡°í•©ì…ë‹ˆë‹¤. ê°ì„±ì  ìš”ì†Œë¡œ ê³µìœ ìœ¨ì´ ë†’ê³ , ë ˆì‹œí”¼ ì½˜í…ì¸ ëŠ” ì €ì¥ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.",
            targetAudience: "50-70ì„¸, ìš”ë¦¬ì™€ ì¶”ì–µì— ê´€ì‹¬ ìˆëŠ” ì‹œë‹ˆì–´",
            keywords: ["ì–´ë¨¸ë‹ˆìš”ë¦¬", "ë ˆì‹œí”¼", "ì¶”ì–µ", "ì „í†µìŒì‹", "ë³µì›"],
            blueOcean: 89,
            competition: "ë§¤ìš° ë‚®ìŒ",
            views: "20ë§Œ~55ë§Œ",
            revenue: "80ë§Œ~275ë§Œì›",
            growth: "ë¸”ë£¨ì˜¤ì…˜"
        },
        {
            id: 43,
            title: "í˜¼ìì„œë„ í–‰ë³µí•œ 60ëŒ€ì˜ í•˜ë£¨ ë£¨í‹´",
            icon: "â˜€ï¸",
            reason: "ë…ê±° ì‹œë‹ˆì–´ê°€ ëŠ˜ì–´ë‚˜ëŠ” ì‹œëŒ€, ê¸ì •ì ì¸ 1ì¸ ìƒí™œ ì½˜í…ì¸ ëŠ” ê³µê°ê³¼ ì‘ì›ì„ ë°›ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸, 1ì¸ ê°€êµ¬ ë˜ëŠ” ì¤€ë¹„í•˜ëŠ” ì‹œë‹ˆì–´",
            keywords: ["1ì¸ê°€êµ¬", "ì¼ìƒ", "60ëŒ€", "í–‰ë³µ", "ë£¨í‹´"],
            blueOcean: 84,
            competition: "ë‚®ìŒ",
            views: "22ë§Œ~60ë§Œ",
            revenue: "88ë§Œ~300ë§Œì›",
            growth: "ê¸‰ìƒìŠ¹"
        },
        {
            id: 44,
            title: "ì†ì£¼ì™€ í•¨ê»˜í•˜ë©´ ì¢‹ì€ ì˜›ë‚  ë†€ì´ 10ê°€ì§€",
            icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
            reason: "ì„¸ëŒ€ ê°„ ì†Œí†µ ì½˜í…ì¸ ëŠ” ì‹œë‹ˆì–´ì™€ ì Šì€ ë¶€ëª¨ ëª¨ë‘ë¥¼ íƒ€ê²ŸíŒ…í•  ìˆ˜ ìˆì–´ ì‹œì²­ì¸µì´ ë„“ìŠµë‹ˆë‹¤.",
            targetAudience: "55-75ì„¸ ì‹œë‹ˆì–´, 30-45ì„¸ ë¶€ëª¨",
            keywords: ["ì†ì£¼", "ì˜›ë‚ ë†€ì´", "ì„¸ëŒ€ì†Œí†µ", "ê°€ì¡±", "ì¶”ì–µ"],
            blueOcean: 87,
            competition: "ë§¤ìš° ë‚®ìŒ",
            views: "18ë§Œ~50ë§Œ",
            revenue: "72ë§Œ~250ë§Œì›",
            growth: "í‹ˆìƒˆì‹œì¥"
        }
    ]
};

// ===== ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿ =====
const scriptTemplates = {
    shorts: {
        story: `[HOOK - 0~3ì´ˆ]
{hook}

[ì „ê°œ - 3~30ì´ˆ]
{development}

[í´ë¼ì´ë§¥ìŠ¤ - 30~50ì´ˆ]
{climax}

[ê²°ë§ - 50~60ì´ˆ]
{ending}

[CTA]
ì´ëŸ° ì´ì•¼ê¸° ë” ë³´ê³  ì‹¶ìœ¼ì‹œë©´
êµ¬ë…ê³¼ ì¢‹ì•„ìš” ë¶€íƒë“œë ¤ìš” ğŸ’•`,

        health: `[HOOK - 0~3ì´ˆ]
{hook}

[ë¬¸ì œ ì œê¸° - 3~15ì´ˆ]
{problem}

[í•´ê²°ì±… - 15~45ì´ˆ]
{solution}

[ì‹¤ì²œ ë°©ë²• - 45~55ì´ˆ]
{action}

[CTA]
ê±´ê°• ì •ë³´ ë” ë°›ì•„ë³´ì‹œë ¤ë©´
êµ¬ë… ëˆŒëŸ¬ì£¼ì„¸ìš” â¤ï¸`,

        history: `[HOOK - 0~3ì´ˆ]
{hook}

[ë°°ê²½ ì„¤ëª… - 3~20ì´ˆ]
{background}

[í•µì‹¬ ë‚´ìš© - 20~50ì´ˆ]
{main}

[ë§ˆë¬´ë¦¬ - 50~60ì´ˆ]
{conclusion}

[CTA]
ì—­ì‚¬ ì´ì•¼ê¸° ë” ë³´ì‹œë ¤ë©´
êµ¬ë… ë¶€íƒë“œë ¤ìš” ğŸ“š`,

        finance: `[HOOK - 0~3ì´ˆ]
{hook}

[í˜„ì‹¤ ë¬¸ì œ - 3~15ì´ˆ]
{problem}

[í•µì‹¬ ì •ë³´ - 15~45ì´ˆ]
{info}

[ì‹¤ì²œ íŒ - 45~55ì´ˆ]
{tips}

[CTA]
ì•Œì§œ ì¬í…Œí¬ ì •ë³´ ë°›ìœ¼ì‹œë ¤ë©´
êµ¬ë… ê¾¹! ğŸ’°`,

        hobby: `[HOOK - 0~3ì´ˆ]
{hook}

[ì†Œê°œ - 3~20ì´ˆ]
{intro}

[ë³¸ë¡  - 20~50ì´ˆ]
{main}

[ë§ˆë¬´ë¦¬ - 50~60ì´ˆ]
{ending}

[CTA]
ì¦ê±°ìš´ ì¼ìƒ í•¨ê»˜í•˜ì‹œë ¤ë©´
êµ¬ë… ë¶€íƒë“œë ¤ìš” ğŸµ`
    },
    long: {
        story: `[ì¸íŠ¸ë¡œ - 0~30ì´ˆ]
ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ë„ ì°¾ì•„ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

ì˜¤ëŠ˜ì€ ì •ë§ íŠ¹ë³„í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ë“œë¦¬ë ¤ê³  í•©ë‹ˆë‹¤.
{intro}

[ë³¸ë¡  1 - 30ì´ˆ~3ë¶„]
ì´ì•¼ê¸°ëŠ” ì´ë ‡ê²Œ ì‹œì‘ë©ë‹ˆë‹¤.
{part1}

[ë³¸ë¡  2 - 3ë¶„~6ë¶„]
ê·¸ëŸ°ë° ì—¬ê¸°ì„œ ì˜ˆìƒì¹˜ ëª»í•œ ì¼ì´ ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤.
{part2}

[ë³¸ë¡  3 - 6ë¶„~8ë¶„]
ê·¸ë¦¬ê³  ë§ˆì¹¨ë‚´...
{part3}

[ê²°ë¡  - 8ë¶„~9ë¶„]
ì´ ì´ì•¼ê¸°ê°€ ìš°ë¦¬ì—ê²Œ ì£¼ëŠ” êµí›ˆì€
{conclusion}

[ì•„ì›ƒíŠ¸ë¡œ - 9ë¶„~10ë¶„]
ì˜¤ëŠ˜ ì´ì•¼ê¸° ì–´ë– ì…¨ë‚˜ìš”?
ë¹„ìŠ·í•œ ê²½í—˜ ìˆìœ¼ì‹œë©´ ëŒ“ê¸€ë¡œ ë‚˜ëˆ ì£¼ì„¸ìš”.
ë‹¤ìŒ ì´ì•¼ê¸°ë„ ê¸°ëŒ€í•´ì£¼ì‹œê³ ,
êµ¬ë…ê³¼ ì¢‹ì•„ìš” ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”! ğŸ’•`,

        health: `[ì¸íŠ¸ë¡œ - 0~30ì´ˆ]
ì•ˆë…•í•˜ì„¸ìš”, ê±´ê°•í•œ í•˜ë£¨ ë˜ê³  ê³„ì‹ ê°€ìš”?

ì˜¤ëŠ˜ì€ ë§ì€ ë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì…¨ë˜
{topic}ì— ëŒ€í•´ ìì„¸íˆ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

[ë¬¸ì œ ì¸ì‹ - 30ì´ˆ~2ë¶„]
ë¨¼ì €, ì™œ ì´ê²ƒì´ ì¤‘ìš”í•œì§€ ì•Œì•„ë³¼ê¹Œìš”?
{problem}

[ì›ì¸ ë¶„ì„ - 2ë¶„~4ë¶„]
ê·¸ë ‡ë‹¤ë©´ ì›ì¸ì€ ë¬´ì—‡ì¼ê¹Œìš”?
{causes}

[í•´ê²°ì±… ì œì‹œ - 4ë¶„~7ë¶„]
ì œê°€ ì§ì ‘ íš¨ê³¼ë¥¼ ë³¸ ë°©ë²•ì„ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
{solutions}

[ì‹¤ì²œ ê°€ì´ë“œ - 7ë¶„~9ë¶„]
ì˜¤ëŠ˜ë¶€í„° ë°”ë¡œ ì‹¤ì²œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
{guide}

[ì•„ì›ƒíŠ¸ë¡œ - 9ë¶„~10ë¶„]
ì˜¤ëŠ˜ ë‚´ìš© ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”?
ë” ê¶ê¸ˆí•œ ê±´ê°• ì£¼ì œ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.
êµ¬ë…í•˜ì‹œë©´ ë§¤ì£¼ ê±´ê°• ì •ë³´ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”.
ê±´ê°•í•˜ì„¸ìš”! â¤ï¸`
    }
};

// ===== ìƒíƒœ ê´€ë¦¬ =====
let currentCategory = 'all';
let currentTopics = [];
let selectedTopic = null;
let currentContentType = 'shorts';

// ===== ì´ˆê¸°í™” =====
document.addEventListener('DOMContentLoaded', function () {
    loadSavedCategories(); // ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ ë¨¼ì € ë¡œë“œ
    loadApiSettings(); // API í‚¤ ë¡œë“œ
    setupCategoryButtons();
    generateTopics();
    renderDiscoveryEmpty();
});

// ===== ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ ë¡œë“œ =====
function loadSavedCategories() {
    const saved = JSON.parse(localStorage.getItem('senior_custom_categories') || '[]');
    if (saved.length === 0) return;

    const grid = document.getElementById('categoryGrid');

    saved.forEach(category => {
        // ë²„íŠ¼ ì¶”ê°€
        const newBtn = document.createElement('button');
        newBtn.className = 'category-btn custom';
        newBtn.dataset.category = category.id;
        newBtn.innerHTML = `
            <span class="cat-icon">${category.icon}</span>
            <span class="cat-name">${category.name}</span>
        `;
        newBtn.addEventListener('click', function () {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentCategory = this.dataset.category;
            generateTopicsForCustomCategory(category);
        });
        grid.appendChild(newBtn);

        // í† í”½ ë°ì´í„°ë² ì´ìŠ¤ì— ì¶”ê°€
        addCustomCategoryTopics(category);
    });

    customCategories = saved;
}

// ===== ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì„¤ì • =====
function setupCategoryButtons() {
    const buttons = document.querySelectorAll('.category-btn');
    buttons.forEach(btn => {
        btn.addEventListener('click', function () {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentCategory = this.dataset.category;
            generateTopics();
            updateNicheChannelUI(); // ë‹ˆì¹˜ ì±„ë„ UI ì—…ë°ì´íŠ¸
        });
    });
}

// ===== API í‚¤ ê´€ë¦¬ =====
let youtubeApiKey = localStorage.getItem('youtube_api_key') || '';
let geminiApiKey = localStorage.getItem('gemini_api_key') || '';
let currentDiscoveryType = 'niche'; // 'niche', 'mass', 'both'

// API ì„¤ì • í† ê¸€
function toggleApiSettings() {
    const body = document.getElementById('apiSettingsBody');
    const arrow = document.getElementById('apiToggleArrow');
    if (body.style.display === 'none') {
        body.style.display = 'block';
        arrow.classList.add('open');
    } else {
        body.style.display = 'none';
        arrow.classList.remove('open');
    }
}

// API ì„¤ì • ì €ì¥
function saveApiSettings() {
    youtubeApiKey = document.getElementById('youtubeApiKey').value.trim();
    geminiApiKey = document.getElementById('geminiApiKey').value.trim();
    localStorage.setItem('youtube_api_key', youtubeApiKey);
    localStorage.setItem('gemini_api_key', geminiApiKey);
    showToast('âœ… API ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    toggleApiSettings();
}

// API ì„¤ì • ë¡œë“œ
function loadApiSettings() {
    document.getElementById('youtubeApiKey').value = youtubeApiKey;
    document.getElementById('geminiApiKey').value = geminiApiKey;
}

// ë°œêµ´ íƒ€ì… ì„ íƒ
function setDiscoveryType(type) {
    currentDiscoveryType = type;
    document.querySelectorAll('.discovery-type-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
    });
}

// ===== ì¹´í…Œê³ ë¦¬ ë°œêµ´ ê¸°ëŠ¥ (API ì—°ë™) =====
let discoveryCount = 0;

async function discoverCategories() {
    const btn = document.querySelector('.btn-discover');
    btn.classList.add('loading');
    btn.innerHTML = '<span class="discover-icon">ğŸ”„</span> íŠ¸ë Œë“œ ë¶„ì„ ì¤‘...';

    discoveryCount++;

    try {
        let categories = [];

        // YouTube APIë¡œ íŠ¸ë Œë“œ ë¶„ì„
        if (youtubeApiKey) {
            const trendData = await fetchYouTubeTrends();
            if (trendData && trendData.length > 0) {
                // Gemini APIë¡œ ì¹´í…Œê³ ë¦¬ ë¶„ì„
                if (geminiApiKey) {
                    categories = await analyzeWithGemini(trendData);
                } else {
                    categories = processYouTubeData(trendData);
                }
            }
        }

        // API ì—†ê±°ë‚˜ ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ë¡œì§
        if (categories.length === 0) {
            categories = getLocalCategories();
        }

        // ë°œêµ´ íƒ€ì…ì— ë”°ë¼ í•„í„°ë§
        categories = filterByDiscoveryType(categories);

        discoveredCategoryList = categories.slice(0, 6);
        renderDiscoveredCategories();

        const typeNames = { niche: 'ë‹ˆì¹˜í˜•', mass: 'ëŒ€ì¤‘í˜•', both: 'ê· í˜•' };
        showToast(`âœ¨ ${typeNames[currentDiscoveryType]} ì¹´í…Œê³ ë¦¬ ${discoveredCategoryList.length}ê°œ ë°œêµ´!`);

    } catch (error) {
        console.error('Discovery error:', error);
        // í´ë°±: ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ì‚¬ìš©
        discoveredCategoryList = getLocalCategories().slice(0, 6);
        renderDiscoveredCategories();
        showToast('âš ï¸ API ì˜¤ë¥˜ë¡œ ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
    }

    btn.classList.remove('loading');
    btn.innerHTML = '<span class="discover-icon">âœ¨</span> AI íŠ¸ë Œë“œ ë¶„ì„ ë°œêµ´';
}

// YouTube Data APIë¡œ ì‹œë‹ˆì–´ ê´€ë ¨ íŠ¸ë Œë“œ ê°€ì ¸ì˜¤ê¸°
async function fetchYouTubeTrends() {
    const searchQueries = ['ì‹œë‹ˆì–´', '60ëŒ€', '70ëŒ€', 'ê±´ê°•', 'ë…¸í›„', 'ì€í‡´'];
    const query = searchQueries[Math.floor(Math.random() * searchQueries.length)];

    try {
        const response = await fetch(
            `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=10&order=viewCount&relevanceLanguage=ko&regionCode=KR&key=${youtubeApiKey}`
        );

        if (!response.ok) throw new Error('YouTube API ì˜¤ë¥˜');

        const data = await response.json();
        return data.items?.map(item => ({
            title: item.snippet.title,
            description: item.snippet.description,
            channelTitle: item.snippet.channelTitle
        })) || [];
    } catch (error) {
        console.warn('YouTube API ì‹¤íŒ¨:', error);
        return [];
    }
}

// Gemini APIë¡œ íŠ¸ë Œë“œ ë¶„ì„
async function analyzeWithGemini(trendData) {
    const typePrompts = {
        niche: 'ê²½ìŸì´ ì ê³  ì¶©ì„±ë„ ë†’ì€ ë‹ˆì¹˜ ì‹œì¥ ì¹´í…Œê³ ë¦¬',
        mass: 'ì¡°íšŒìˆ˜ê°€ ë†’ì€ ëŒ€ì¤‘ì ì¸ ì¸ê¸° ì¹´í…Œê³ ë¦¬',
        both: 'ë‹ˆì¹˜í˜•ê³¼ ëŒ€ì¤‘í˜•ì„ ê· í˜•ìˆê²Œ ì„ì€ ì¹´í…Œê³ ë¦¬'
    };

    const prompt = `ë‹¤ìŒ YouTube íŠ¸ë Œë“œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ í•œêµ­ ì‹œë‹ˆì–´(50-70ëŒ€) ëŒ€ìƒ ì½˜í…ì¸  ì¹´í…Œê³ ë¦¬ 6ê°œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.
íƒ€ì…: ${typePrompts[currentDiscoveryType]}

íŠ¸ë Œë“œ ë°ì´í„°:
${trendData.map(t => `- ${t.title}`).join('\n')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µ:
[{"name": "ì¹´í…Œê³ ë¦¬ëª…", "icon": "ì´ëª¨ì§€", "description": "ì„¤ëª…", "blueOcean": ì ìˆ˜(70-99), "competition": "ê²½ìŸë„", "avgRevenue": "ì˜ˆìƒìˆ˜ìµ", "type": "niche/mass", "sampleTopics": ["ì£¼ì œ1", "ì£¼ì œ2"]}]`;

    try {
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.9 }
                })
            }
        );

        if (!response.ok) throw new Error('Gemini API ì˜¤ë¥˜');

        const data = await response.json();
        const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';

        // JSON íŒŒì‹±
        const jsonMatch = text.match(/\[[\s\S]*\]/);
        if (jsonMatch) {
            const categories = JSON.parse(jsonMatch[0]);
            return categories.map((c, i) => ({
                id: `ai-${Date.now()}-${i}`,
                name: c.name,
                icon: c.icon || 'ğŸ¯',
                description: c.description,
                blueOcean: c.blueOcean || 80,
                competition: c.competition || 'ë‚®ìŒ',
                avgRevenue: c.avgRevenue || '50ë§Œ~200ë§Œì›',
                reason: c.description,
                type: c.type || 'niche',
                sampleTopics: c.sampleTopics || [`${c.name} ì‹œì‘í•˜ê¸°`, `${c.name} ê¿€íŒ`],
                isAI: true
            }));
        }
    } catch (error) {
        console.warn('Gemini API ì‹¤íŒ¨:', error);
    }

    return [];
}

// YouTube ë°ì´í„°ë¥¼ ì¹´í…Œê³ ë¦¬ë¡œ ë³€í™˜ (Gemini ì—†ì„ ë•Œ)
function processYouTubeData(trendData) {
    const keywords = {
        'ê±´ê°•': { icon: 'ğŸ’Š', type: 'mass' },
        'ìš´ë™': { icon: 'ğŸƒ', type: 'mass' },
        'ì¬í…Œí¬': { icon: 'ğŸ’°', type: 'niche' },
        'ì—°ê¸ˆ': { icon: 'ğŸ¦', type: 'niche' },
        'ì¶”ì–µ': { icon: 'ğŸ’•', type: 'niche' },
        'ì—¬í–‰': { icon: 'âœˆï¸', type: 'mass' },
        'ìš”ë¦¬': { icon: 'ğŸ³', type: 'mass' },
        'ìŒì•…': { icon: 'ğŸµ', type: 'mass' }
    };

    const found = [];
    trendData.forEach(item => {
        for (const [key, val] of Object.entries(keywords)) {
            if (item.title.includes(key) && !found.find(f => f.name.includes(key))) {
                found.push({
                    id: `yt-${Date.now()}-${found.length}`,
                    name: `ì‹œë‹ˆì–´ ${key}`,
                    icon: val.icon,
                    description: `YouTube íŠ¸ë Œë“œ ê¸°ë°˜ ${key} ì¹´í…Œê³ ë¦¬`,
                    blueOcean: 75 + Math.floor(Math.random() * 20),
                    competition: val.type === 'niche' ? 'ë‚®ìŒ' : 'ì¤‘ê°„',
                    avgRevenue: '50ë§Œ~200ë§Œì›',
                    reason: `${key} ê´€ë ¨ ì‹œë‹ˆì–´ ì½˜í…ì¸  ìˆ˜ìš” ì¦ê°€`,
                    type: val.type,
                    sampleTopics: [`${key} ì‹œì‘í•˜ê¸°`, `${key} ê¿€íŒ`],
                    isAI: true
                });
            }
        }
    });

    return found;
}

// ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ (API ì—†ì„ ë•Œ)
function getLocalCategories() {
    const addedIds = customCategories.map(c => c.id);
    const available = discoveryCategories.filter(c => !addedIds.includes(c.id));

    // ë°œêµ´ íƒ€ì…ì— ë”°ë¼ ì •ë ¬
    if (currentDiscoveryType === 'niche') {
        return [...available].sort((a, b) => b.blueOcean - a.blueOcean);
    } else if (currentDiscoveryType === 'mass') {
        return [...available].sort((a, b) => {
            const getMax = (str) => parseInt(str.match(/\d+/g)?.[1] || 0);
            return getMax(b.avgRevenue) - getMax(a.avgRevenue);
        });
    } else {
        return [...available].sort(() => Math.random() - 0.5);
    }
}

// ë°œêµ´ íƒ€ì…ìœ¼ë¡œ í•„í„°ë§
function filterByDiscoveryType(categories) {
    if (currentDiscoveryType === 'niche') {
        return categories.filter(c => c.type !== 'mass' || c.blueOcean > 85);
    } else if (currentDiscoveryType === 'mass') {
        return categories.filter(c => c.type !== 'niche' || c.blueOcean < 80);
    }
    return categories; // both: ëª¨ë‘ ë°˜í™˜
}

// ===== ì¹´í…Œê³ ë¦¬ë³„ ë‹ˆì¹˜ ì±„ë„ ì£¼ì œ ë°œêµ´ =====
const CATEGORY_NAMES = {
    all: 'ì „ì²´',
    story: 'ì‚¬ì—°/ì¶”ì–µ',
    health: 'ê±´ê°•ì •ë³´',
    history: 'ì•¼ë‹´/ì—­ì‚¬',
    finance: 'ì¬í…Œí¬',
    hobby: 'ì·¨ë¯¸/ë¬¸í™”'
};

const NICHE_CHANNEL_TEMPLATES = {
    story: [
        { name: '6070 ì²«ì‚¬ë‘ ì´ì•¼ê¸°', desc: 'ê³¼ê±°ì˜ ìˆœìˆ˜í•œ ì‚¬ë‘ ì´ì•¼ê¸°ë¥¼ ê³µê° ìŠ¤í† ë¦¬ë¡œ', potentialViews: '10ë§Œ~30ë§Œ' },
        { name: 'êµ°ëŒ€ ì‹œì ˆ ì—í”¼ì†Œë“œ', desc: 'ë‚¨ìë“¤ì˜ ì¶”ì–µ êµ°ëŒ€ ì´ì•¼ê¸°', potentialViews: '15ë§Œ~40ë§Œ' },
        { name: 'ì‹œê³¨ ì¶”ì–µ', desc: 'ë†ì´Œ, ì‹œê³¨ì—ì„œì˜ ì–´ë¦° ì‹œì ˆ ì´ì•¼ê¸°', potentialViews: '8ë§Œ~25ë§Œ' },
        { name: 'ì§ì¥ì¸ ì¶”ì–µ', desc: 'ê³¼ê±° ì§ì¥ìƒí™œì˜ ì—í”¼ì†Œë“œ', potentialViews: '7ë§Œ~20ë§Œ' },
        { name: 'ê°€ì¡± ì‚¬ì—°', desc: 'ë¶€ëª¨ë‹˜, ìë…€ì™€ì˜ ê°ë™ ì‚¬ì—°', potentialViews: '12ë§Œ~35ë§Œ' }
    ],
    health: [
        { name: 'ê´€ì ˆ ê±´ê°•', desc: 'ë¬´ë¦, í—ˆë¦¬ í†µì¦ ê´€ë¦¬ ì •ë³´', potentialViews: '20ë§Œ~60ë§Œ' },
        { name: 'ìˆ˜ë©´ ê±´ê°•', desc: 'ë¶ˆë©´ì¦ ê·¹ë³µ, ìˆ™ë©´ ë¹„ë²•', potentialViews: '15ë§Œ~45ë§Œ' },
        { name: 'ì¹˜ë§¤ ì˜ˆë°©', desc: 'ë‡Œ ê±´ê°•, ì¸ì§€ë ¥ í–¥ìƒ íŒ', potentialViews: '25ë§Œ~70ë§Œ' },
        { name: 'í˜ˆì••/ë‹¹ë‡¨ ê´€ë¦¬', desc: 'ë§Œì„±ì§ˆí™˜ ê´€ë¦¬ ì •ë³´', potentialViews: '18ë§Œ~50ë§Œ' },
        { name: 'ì‹œë‹ˆì–´ ìš´ë™ë²•', desc: 'ì§‘ì—ì„œ í•˜ëŠ” ê°€ë²¼ìš´ ìš´ë™', potentialViews: '12ë§Œ~35ë§Œ' }
    ],
    history: [
        { name: 'ì¡°ì„  ì•¼ë‹´', desc: 'ì¡°ì„ ì‹œëŒ€ ìˆ¨ê²¨ì§„ ì´ì•¼ê¸°', potentialViews: '8ë§Œ~25ë§Œ' },
        { name: 'ê·¼í˜„ëŒ€ì‚¬ ë¹„í™”', desc: 'ì•Œë ¤ì§€ì§€ ì•Šì€ ì—­ì‚¬ ì´ë©´', potentialViews: '10ë§Œ~30ë§Œ' },
        { name: '6.25 ì‹¤í™”', desc: 'í•œêµ­ì „ìŸ ì‹œê¸° ê°ë™ ì´ì•¼ê¸°', potentialViews: '7ë§Œ~22ë§Œ' },
        { name: 'ìœ„ì¸ ì¬ì¡°ëª…', desc: 'ì—­ì‚¬ ì¸ë¬¼ ìƒˆë¡œìš´ ì‹œê°', potentialViews: '9ë§Œ~28ë§Œ' },
        { name: 'ì§€ì—­ ì—­ì‚¬', desc: 'ìš°ë¦¬ ë™ë„¤ ìˆ¨ê²¨ì§„ ì—­ì‚¬', potentialViews: '5ë§Œ~15ë§Œ' }
    ],
    finance: [
        { name: 'ì—°ê¸ˆ ê¿€íŒ', desc: 'êµ­ë¯¼ì—°ê¸ˆ, ì£¼íƒì—°ê¸ˆ ë…¸í•˜ìš°', potentialViews: '15ë§Œ~45ë§Œ' },
        { name: 'ë…¸í›„ ì¬í…Œí¬', desc: 'ì•ˆì „í•œ íˆ¬ì ì „ëµ', potentialViews: '12ë§Œ~38ë§Œ' },
        { name: 'ì ˆì„¸ ë¹„ë²•', desc: 'ìƒì†, ì¦ì—¬ ì„¸ê¸ˆ ì¤„ì´ê¸°', potentialViews: '18ë§Œ~55ë§Œ' },
        { name: 'ì •ë¶€ ì§€ì›ê¸ˆ', desc: 'ì‹œë‹ˆì–´ í˜œíƒ ì´ì •ë¦¬', potentialViews: '25ë§Œ~70ë§Œ' },
        { name: 'ì€í‡´ ì¤€ë¹„', desc: 'ì€í‡´ ì „ ì±™ê²¨ì•¼ í•  ê²ƒë“¤', potentialViews: '10ë§Œ~32ë§Œ' }
    ],
    hobby: [
        { name: 'ì‹œë‹ˆì–´ ì—¬í–‰', desc: 'ìˆ¨ì€ ì—¬í–‰ì§€, ê±·ê¸° ì½”ìŠ¤', potentialViews: '12ë§Œ~35ë§Œ' },
        { name: 'ì „í†µ ìš”ë¦¬', desc: 'ì–´ë¨¸ë‹ˆì˜ ì†ë§› ë ˆì‹œí”¼', potentialViews: '10ë§Œ~30ë§Œ' },
        { name: 'ì†ì£¼ ìœ¡ì•„', desc: 'ì¡°ë¶€ëª¨ ìœ¡ì•„ íŒ', potentialViews: '8ë§Œ~25ë§Œ' },
        { name: 'ì‹œë‹ˆì–´ ì·¨ë¯¸', desc: 'ì„œì˜ˆ, ë°”ë‘‘, ì›ì˜ˆ ë“±', potentialViews: '6ë§Œ~18ë§Œ' },
        { name: 'íŠ¸ë¡œíŠ¸/ìŒì•…', desc: 'íŠ¸ë¡œíŠ¸ ì†Œì‹, ê°€ìˆ˜ ì´ì•¼ê¸°', potentialViews: '15ë§Œ~45ë§Œ' }
    ]
};

// ë‹ˆì¹˜ ì±„ë„ ë°œêµ´ í•¨ìˆ˜
async function discoverNicheChannels() {
    const btn = document.getElementById('btnNicheDiscover');
    const textSpan = document.getElementById('nicheDiscoverText');
    const resultsDiv = document.getElementById('nicheChannelResults');

    btn.classList.add('loading');
    textSpan.textContent = 'ë¶„ì„ ì¤‘...';

    const categoryName = CATEGORY_NAMES[currentCategory] || 'ì‹œë‹ˆì–´';
    document.getElementById('nicheChannelSubtitle').textContent =
        `"${categoryName}" ë¶„ì•¼ ë‹ˆì¹˜ ì±„ë„ ì£¼ì œë¥¼ ë°œêµ´í•©ë‹ˆë‹¤`;

    try {
        let channels = [];

        // Gemini APIë¡œ ë¶„ì„ (API í‚¤ê°€ ìˆìœ¼ë©´)
        if (geminiApiKey) {
            channels = await analyzeNicheChannelsWithGemini(currentCategory);
        }

        // API ì—†ê±°ë‚˜ ì‹¤íŒ¨ì‹œ í…œí”Œë¦¿ ì‚¬ìš©
        if (channels.length === 0) {
            channels = getLocalNicheChannels(currentCategory);
        }

        renderNicheChannelResults(channels);
        showToast(`ğŸ¯ ${categoryName} ë¶„ì•¼ ë‹ˆì¹˜ ì±„ë„ ${channels.length}ê°œ ë°œêµ´!`);

    } catch (error) {
        console.error('Niche channel discovery error:', error);
        const channels = getLocalNicheChannels(currentCategory);
        renderNicheChannelResults(channels);
        showToast('âš ï¸ ê¸°ë³¸ ë‹ˆì¹˜ ì±„ë„ ì£¼ì œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
    }

    btn.classList.remove('loading');
    textSpan.textContent = 'ë‹ˆì¹˜ ì±„ë„ ì£¼ì œ ë°œêµ´';
}

// Gemini APIë¡œ ë‹ˆì¹˜ ì±„ë„ ë¶„ì„
async function analyzeNicheChannelsWithGemini(category) {
    const categoryName = CATEGORY_NAMES[category] || 'ì‹œë‹ˆì–´';

    const prompt = `í•œêµ­ ì‹œë‹ˆì–´(50-70ëŒ€) ëŒ€ìƒ YouTube ì±„ë„ ì¤‘ "${categoryName}" ë¶„ì•¼ì˜ ë‹ˆì¹˜ ì±„ë„ ì£¼ì œ 6ê°œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ì¡°ê±´:
- ê²½ìŸì´ ì ì€ ë¸”ë£¨ì˜¤ì…˜ ì£¼ì œ
- ì‹œë‹ˆì–´ë“¤ì˜ ì‹¤ì œ ë‹ˆì¦ˆ ë°˜ì˜
- êµ¬ì²´ì ì´ê³  ì°¨ë³„í™”ëœ ì£¼ì œ
- ìˆ˜ìµí™” ê°€ëŠ¥ì„± ë†’ì€ ì£¼ì œ

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µ:
[{
  "name": "ì±„ë„ ì£¼ì œëª…",
  "desc": "ì£¼ì œ ì„¤ëª… (1-2ë¬¸ì¥)",
  "targetAudience": "íƒ€ê²Ÿ ì‹œì²­ì",
  "potentialViews": "ì˜ˆìƒ ì›” ì¡°íšŒìˆ˜",
  "blueOcean": ë¸”ë£¨ì˜¤ì…˜ì ìˆ˜(70-99),
  "contentIdeas": ["ì½˜í…ì¸  ì•„ì´ë””ì–´1", "ì½˜í…ì¸  ì•„ì´ë””ì–´2"],
  "monetization": "ìˆ˜ìµí™” ë°©ë²•"
}]`;

    try {
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.9 }
                })
            }
        );

        if (!response.ok) throw new Error('Gemini API ì˜¤ë¥˜');

        const data = await response.json();
        const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';

        const jsonMatch = text.match(/\[[\s\S]*\]/);
        if (jsonMatch) {
            return JSON.parse(jsonMatch[0]);
        }
    } catch (error) {
        console.warn('Gemini ë‹ˆì¹˜ ì±„ë„ ë¶„ì„ ì‹¤íŒ¨:', error);
    }

    return [];
}

// ë¡œì»¬ í…œí”Œë¦¿ì—ì„œ ë‹ˆì¹˜ ì±„ë„ ê°€ì ¸ì˜¤ê¸°
function getLocalNicheChannels(category) {
    if (category === 'all') {
        // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì—ì„œ ëœë¤ ì„ íƒ
        const allChannels = [];
        Object.keys(NICHE_CHANNEL_TEMPLATES).forEach(cat => {
            const channels = NICHE_CHANNEL_TEMPLATES[cat];
            const random = channels[Math.floor(Math.random() * channels.length)];
            allChannels.push({ ...random, category: cat });
        });
        return allChannels.sort(() => Math.random() - 0.5);
    }

    const templates = NICHE_CHANNEL_TEMPLATES[category] || NICHE_CHANNEL_TEMPLATES.story;
    return templates.map(t => ({
        ...t,
        blueOcean: 75 + Math.floor(Math.random() * 20),
        targetAudience: `55-75ì„¸ ${CATEGORY_NAMES[category]} ê´€ì‹¬ì¸µ`,
        contentIdeas: [`${t.name} ì‹œì‘í•˜ê¸°`, `${t.name} ì„±ê³µ ì‚¬ë¡€`],
        monetization: 'ê´‘ê³  ìˆ˜ìµ + í˜‘ì°¬'
    }));
}

// ë‹ˆì¹˜ ì±„ë„ ê²°ê³¼ ë Œë”ë§
function renderNicheChannelResults(channels) {
    const container = document.getElementById('nicheChannelResults');

    if (channels.length === 0) {
        container.innerHTML = `
            <div class="niche-channel-empty">
                <div class="niche-channel-empty-icon">ğŸ“º</div>
                <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ë°œêµ´ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”</p>
            </div>
        `;
        return;
    }

    const icons = ['ğŸ“º', 'ğŸ¬', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“½ï¸', 'ğŸï¸'];

    container.innerHTML = channels.map((ch, index) => `
        <div class="niche-channel-item" onclick="selectNicheChannel(${index})" data-index="${index}">
            <div class="niche-channel-header">
                <span class="niche-channel-icon">${icons[index % icons.length]}</span>
                <span class="niche-channel-title">${ch.name}</span>
            </div>
            <p class="niche-channel-desc">${ch.desc}</p>
            <div class="niche-channel-metrics">
                <span class="niche-metric highlight">ğŸ¯ ë¸”ë£¨ì˜¤ì…˜ ${ch.blueOcean || 85}ì </span>
                <span class="niche-metric">ğŸ‘ï¸ ${ch.potentialViews}</span>
                <span class="niche-metric">ğŸ‘¤ ${ch.targetAudience || 'ì‹œë‹ˆì–´ì¸µ'}</span>
            </div>
        </div>
    `).join('');
}

// ë‹ˆì¹˜ ì±„ë„ ì„ íƒì‹œ ì£¼ì œ ìƒì„±
function selectNicheChannel(index) {
    const container = document.getElementById('nicheChannelResults');
    const items = container.querySelectorAll('.niche-channel-item');
    items.forEach((item, i) => {
        item.style.borderColor = i === index ? '#10b981' : '';
    });

    // í•´ë‹¹ ì±„ë„ ê´€ë ¨ ì£¼ì œ ìƒì„±
    generateTopics();
    showToast('ğŸ“º í•´ë‹¹ ì±„ë„ ì£¼ì œë¡œ ë‹ˆì¹˜ ì£¼ì œë¥¼ ìƒì„±í•©ë‹ˆë‹¤!');
}

// ì¹´í…Œê³ ë¦¬ ë³€ê²½ì‹œ ë‹ˆì¹˜ ì±„ë„ UI ì—…ë°ì´íŠ¸
function updateNicheChannelUI() {
    const categoryName = CATEGORY_NAMES[currentCategory] || 'ì‹œë‹ˆì–´';
    document.getElementById('nicheChannelSubtitle').textContent =
        `"${categoryName}" ë¶„ì•¼ ë‹ˆì¹˜ ì±„ë„ ì£¼ì œë¥¼ ë°œêµ´í•©ë‹ˆë‹¤`;
    document.getElementById('nicheChannelResults').innerHTML = '';
}

// ë™ì  ì¹´í…Œê³ ë¦¬ ìƒì„±
function generateDynamicCategory() {
    const prefix = categoryModifiers.prefixes[Math.floor(Math.random() * categoryModifiers.prefixes.length)];
    const trend = categoryModifiers.trends[Math.floor(Math.random() * categoryModifiers.trends.length)];
    const suffix = categoryModifiers.suffixes[Math.floor(Math.random() * categoryModifiers.suffixes.length)];

    const icons = ['ğŸŒŸ', 'ğŸ’«', 'ğŸ¯', 'ğŸ”®', 'âœ¨', 'ğŸš€', 'ğŸ’¡', 'ğŸ”¥'];
    const randomIcon = icons[Math.floor(Math.random() * icons.length)];

    const dynamicId = `dynamic-${Date.now()}`;
    const dynamicName = `${prefix} ${trend} ${suffix}`;

    return {
        id: dynamicId,
        name: dynamicName,
        icon: randomIcon,
        description: `${prefix} ì‹œë‹ˆì–´ë¥¼ ìœ„í•œ ${trend} ê´€ë ¨ ì½˜í…ì¸ `,
        blueOcean: 85 + Math.floor(Math.random() * 15),
        competition: ['ë§¤ìš° ë‚®ìŒ', 'ë‚®ìŒ', 'ë‚®ìŒ'][Math.floor(Math.random() * 3)],
        avgRevenue: `${50 + Math.floor(Math.random() * 100)}ë§Œ~${150 + Math.floor(Math.random() * 200)}ë§Œì›`,
        reason: `${prefix} ì‹œë‹ˆì–´ì˜ ${trend}ì— ëŒ€í•œ ê´€ì‹¬ì´ ë†’ì§€ë§Œ ë§ì¶¤ ì½˜í…ì¸ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.`,
        sampleTopics: [
            `${prefix} ${trend} ì‹œì‘í•˜ëŠ” ë²•`,
            `${trend} ${suffix} - ì‹¤ì œ ê²½í—˜ë‹´`,
            `${prefix}ë¥¼ ìœ„í•œ ${trend} ì™„ì „ ì •ë³µ`
        ],
        isDynamic: true
    };
}

function renderDiscoveryEmpty() {
    const container = document.getElementById('discoveredCategories');
    container.innerHTML = `
        <div class="discovery-empty">
            <div class="discovery-empty-icon">ğŸ”®</div>
            <p>AI ë°œêµ´ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬<br>ìˆ¨ê²¨ì§„ ë¸”ë£¨ì˜¤ì…˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
        </div>
    `;
}

function renderDiscoveredCategories() {
    const container = document.getElementById('discoveredCategories');

    container.innerHTML = discoveredCategoryList.map((cat, index) => {
        const isAdded = customCategories.find(c => c.id === cat.id);
        return `
            <div class="discovered-category-item ${isAdded ? 'added' : ''}" style="animation-delay: ${index * 0.1}s">
                <div class="disc-cat-icon">${cat.icon}</div>
                <div class="disc-cat-info">
                    <div class="disc-cat-name">${cat.name}</div>
                    <div class="disc-cat-desc">${cat.description}</div>
                    <div class="disc-cat-metrics">
                        <span class="disc-metric blue-ocean">ğŸ”µ ${cat.blueOcean}ì </span>
                        <span class="disc-metric competition">ğŸŸ¢ ${cat.competition}</span>
                        <span class="disc-metric revenue">ğŸ’° ${cat.avgRevenue}</span>
                    </div>
                </div>
                <button class="btn-add-category ${isAdded ? 'added' : ''}" 
                        onclick="addCategoryToGrid('${cat.id}')"
                        ${isAdded ? 'disabled' : ''}>
                    ${isAdded ? 'âœ“ ì¶”ê°€ë¨' : '+ ì¶”ê°€'}
                </button>
            </div>
        `;
    }).join('');
}

function addCategoryToGrid(categoryId) {
    const category = discoveryCategories.find(c => c.id === categoryId);
    if (!category || customCategories.find(c => c.id === categoryId)) return;

    // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ì— ì¶”ê°€
    customCategories.push(category);

    // ì¹´í…Œê³ ë¦¬ ê·¸ë¦¬ë“œì— ë²„íŠ¼ ì¶”ê°€
    const grid = document.getElementById('categoryGrid');
    const newBtn = document.createElement('button');
    newBtn.className = 'category-btn custom';
    newBtn.dataset.category = category.id;
    newBtn.innerHTML = `
        <span class="cat-icon">${category.icon}</span>
        <span class="cat-name">${category.name}</span>
    `;
    newBtn.addEventListener('click', function () {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentCategory = this.dataset.category;
        generateTopicsForCustomCategory(category);
    });
    grid.appendChild(newBtn);

    // ë°œêµ´ ëª©ë¡ UI ì—…ë°ì´íŠ¸
    renderDiscoveredCategories();

    // í† í”½ ë°ì´í„°ë² ì´ìŠ¤ì— ì„ì‹œ ì£¼ì œ ì¶”ê°€
    addCustomCategoryTopics(category);

    // localStorageì— ì €ì¥
    saveCustomCategories();

    showToast(`"${category.name}" ì¹´í…Œê³ ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
}

// ===== ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì €ì¥ =====
function saveCustomCategories() {
    localStorage.setItem('senior_custom_categories', JSON.stringify(customCategories));
}

function addCustomCategoryTopics(category) {
    // ìƒ˜í”Œ í† í”½ì„ ê¸°ë°˜ìœ¼ë¡œ ì£¼ì œ ìƒì„±
    const nextId = 100 + customCategories.length * 10;

    topicsDatabase[category.id] = category.sampleTopics.map((title, index) => ({
        id: nextId + index,
        title: title,
        icon: category.icon,
        reason: category.reason,
        targetAudience: `ì‹œë‹ˆì–´ ${category.name} ê´€ì‹¬ì¸µ`,
        keywords: [category.name, ...title.split(' ').slice(0, 3)],
        blueOcean: category.blueOcean - Math.floor(Math.random() * 10),
        competition: category.competition,
        views: category.avgRevenue.split('~')[0] + '~' + category.avgRevenue.split('~')[0].replace(/\d+/, m => parseInt(m) * 2),
        revenue: category.avgRevenue,
        growth: category.blueOcean > 85 ? 'ê¸‰ìƒìŠ¹' : 'ì•ˆì •ì '
    }));
}

function generateTopicsForCustomCategory(category) {
    if (topicsDatabase[category.id]) {
        currentTopics = [...topicsDatabase[category.id]];
        renderTopics();
    }
}

// ===== ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì„¤ì • =====
function setupCategoryButtons() {
    const buttons = document.querySelectorAll('.category-btn');
    buttons.forEach(btn => {
        btn.addEventListener('click', function () {
            buttons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentCategory = this.dataset.category;
            generateTopics();
        });
    });
}

// ===== ë™ì  ì£¼ì œ í…œí”Œë¦¿ =====
const DYNAMIC_TOPIC_TEMPLATES = {
    story: [
        "6070 {modifier} ì´ì•¼ê¸°, {emotion} ìˆœê°„ë“¤",
        "{era}ë…„ëŒ€ {thing}ì˜ ì¶”ì–µ, ì§€ê¸ˆì€ ì‚¬ë¼ì§„ {thing2}",
        "{relationship}ì—ê²Œ ì°¨ë§ˆ ë§ ëª»í•œ {emotion} ì´ì•¼ê¸°",
        "ìš°ë¦¬ ë™ë„¤ {place}ì—ì„œ ìˆì—ˆë˜ ë¯¿ê¸° í˜ë“  ì¼",
        "{job}ë¡œ {years}ë…„, ì„¸ìƒì— ì´ëŸ° ì¼ì´",
        "6070 {season} ì¶”ì–µ, ê·¸ë•Œ ìš°ë¦¬ëŠ” {activity}",
        "{generation}ì´ {activity} í•˜ë˜ ì‹œì ˆ ì´ì•¼ê¸°"
    ],
    health: [
        "{bodypart} í†µì¦, {duration} ë§Œì— í•´ê²°í•œ {method}",
        "{age}ëŒ€ {symptom}, ì´ê²ƒë§Œ í•˜ë©´ {result}",
        "{time}ì— {activity} í•˜ë©´ {bodypart}ê°€ ì‚´ì•„ë‚œë‹¤",
        "{food}ì˜ ìˆ¨ê²¨ì§„ íš¨ëŠ¥, {disease} ì˜ˆë°©ì— íƒì›”",
        "{specialist}ê°€ ë§¤ì¼ í•˜ëŠ” {health_habit} ë¹„ë²•",
        "{season}ì²  {symptom} ì˜ˆë°©, {number}ê°€ì§€ ë°©ë²•",
        "{age}ëŒ€ í•„ìˆ˜ {vitamin}, ì´ë ‡ê²Œ ë¨¹ì–´ì•¼ íš¨ê³¼"
    ],
    history: [
        "{era}ë…„ëŒ€ {event}, ì—­ì‚¬ê°€ ìˆ¨ê¸´ ì§„ì‹¤",
        "{historical_figure}ì˜ ë§ˆì§€ë§‰ {action}, ì•Œë ¤ì§€ì§€ ì•Šì€ ì´ì•¼ê¸°",
        "{place}ì—ì„œ ë°œê²¬ëœ {object}ì˜ ë¹„ë°€",
        "ì¡°ì„ ì‹œëŒ€ {topic}, í˜„ëŒ€ì¸ì´ ëª¨ë¥´ëŠ” ì‚¬ì‹¤",
        "{era}ë…„ëŒ€ {thing}ì˜ ì›ì¡°ëŠ” í•œêµ­ì´ì—ˆë‹¤",
        "6.25 ë•Œ {region}ì—ì„œ ìˆì—ˆë˜ ê¸°ì  ê°™ì€ ì´ì•¼ê¸°",
        "{historical_event} ë’¤ì— ìˆ¨ê²¨ì§„ {emotion} ì´ì•¼ê¸°"
    ],
    finance: [
        "{benefit}, ì‹ ì²­ ì•ˆ í•˜ë©´ {amount} ì†í•´",
        "{age}ëŒ€ {financial_product} í•„ìˆ˜ ê°€ì… ì‹œê¸°",
        "{asset}ìœ¼ë¡œ {income}, ì•ˆì „í•œ ë°©ë²• ê³µê°œ",
        "ì€í‡´ í›„ {period} ì•ˆì— í•´ì•¼ í•  {number}ê°€ì§€",
        "{scheme} í”¼í•˜ëŠ” ë²•, ì‹¤ì œ í”¼í•´ ì‚¬ë¡€",
        "{government_benefit} ë” ë°›ëŠ” ìˆ¨ì€ ë°©ë²•",
        "ë¶€ëª¨ë‹˜ {asset} ë¬¼ë ¤ë°›ì„ ë•Œ ì„¸ê¸ˆ {percent}% ì ˆì•½ë²•"
    ],
    hobby: [
        "{age}ëŒ€ {hobby} ì‹œì‘í•˜ê¸°, ëŠ¦ì§€ ì•Šì•˜ì–´ìš”",
        "ì†ì£¼ì™€ í•¨ê»˜í•˜ëŠ” {activity}, ì„¸ëŒ€ ì†Œí†µë²•",
        "í˜¼ìì„œë„ ì¦ê±°ìš´ {hobby} {number}ê°€ì§€",
        "{celebrity}ê°€ {age}ì„¸ì—ë„ ê±´ê°•í•œ ë¹„ê²°",
        "{season}ì— ê°€ê¸° ì¢‹ì€ {place_type} ì¶”ì²œ",
        "{time}ë§ˆë‹¤ {activity} í•˜ë©´ {benefit}",
        "ì€í‡´ í›„ {hobby}ë¡œ {income} ë²„ëŠ” ì‚¬ëŒë“¤"
    ]
};

// ë™ì  ì£¼ì œ ìƒì„±ìš© ë°ì´í„°
const TOPIC_FILLERS = {
    modifier: ['ì²«ì‚¬ë‘', 'ìš°ì •', 'ì´ë³„', 'ì¬íšŒ', 'ë¹„ë°€', 'ëˆˆë¬¼', 'ê°ë™', 'ë°˜ì „'],
    emotion: ['í–‰ë³µí–ˆë˜', 'ìŠ¬íë˜', 'ê°ë™ì ì¸', 'ì¶©ê²©ì ì¸', 'ë”°ëœ»í•œ', 'ëœ¨ê±°ìš´'],
    era: ['1960', '1970', '1980', '1990', '2000'],
    thing: ['ë²„ìŠ¤', 'ì „í™”', 'í…”ë ˆë¹„ì „', 'ë¼ë””ì˜¤', 'ì‹œì¥', 'í•™êµ', 'ë†€ì´í„°'],
    thing2: ['í’ê²½', 'ë¬¸í™”', 'ì •ì„œ', 'ì¶”ì–µ', 'ì‚¬ëŒë“¤'],
    relationship: ['ìë…€', 'ë¶€ëª¨ë‹˜', 'ë°°ìš°ì', 'ì¹œêµ¬', 'ì²«ì‚¬ë‘'],
    place: ['ì‹œì¥', 'í•™êµ', 'ê³µì›', 'ê³¨ëª©', 'ì •ë¥˜ì¥', 'ìš°ì²´êµ­', 'ì´ë°œì†Œ'],
    job: ['êµì‚¬', 'êµ°ì¸', 'ë†ë¶€', 'ìƒì¸', 'ê°„í˜¸ì‚¬', 'ê³µë¬´ì›', 'ê¸°ìˆ ì'],
    years: ['10', '20', '30', '40'],
    season: ['ë´„', 'ì—¬ë¦„', 'ê°€ì„', 'ê²¨ìš¸'],
    activity: ['ê±·ê¸°', 'ë…¸ë˜í•˜ê¸°', 'ì¶¤ì¶”ê¸°', 'ìš”ë¦¬í•˜ê¸°', 'ë…ì„œ', 'ì—¬í–‰', 'ìš´ë™'],
    generation: ['ë² ì´ë¹„ë¶€ë¨¸', '386ì„¸ëŒ€', 'ì‚°ì—…í™”ì„¸ëŒ€'],
    bodypart: ['ë¬´ë¦', 'í—ˆë¦¬', 'ì–´ê¹¨', 'ëª©', 'ì†ëª©', 'ë°œëª©', 'ëˆˆ', 'ê·€'],
    duration: ['10ë…„', '5ë…„', '3ê°œì›”', '1ì£¼ì¼'],
    method: ['ìš´ë™ë²•', 'ì§€ì••ë²•', 'ìŠ¤íŠ¸ë ˆì¹­', 'ì‹ì´ìš”ë²•', 'ìƒí™œìŠµê´€'],
    age: ['50', '60', '70', '80'],
    symptom: ['ê´€ì ˆí†µ', 'ë¶ˆë©´ì¦', 'ì†Œí™”ë¶ˆëŸ‰', 'í”¼ë¡œê°', 'ì–´ì§€ëŸ¼ì¦', 'í˜ˆì••'],
    time: ['ì•„ì¹¨', 'ì €ë…', 'ì‹í›„', 'ì·¨ì¹¨ì „', 'ê¸°ìƒí›„'],
    result: ['ì™„í™”ëœë‹¤', 'ì¢‹ì•„ì§„ë‹¤', 'ì˜ˆë°©ëœë‹¤', 'ê°œì„ ëœë‹¤'],
    food: ['ë§ˆëŠ˜', 'ìƒê°•', 'ëœì¥', 'ì²­êµ­ì¥', 'ë¯¸ì—­', 'ë‹¹ê·¼', 'í˜¸ë‘', 'ì–‘íŒŒ'],
    disease: ['ì¹˜ë§¤', 'ë‹¹ë‡¨', 'ê³ í˜ˆì••', 'ê´€ì ˆì—¼', 'ì•”', 'ì‹¬ì¥ë³‘'],
    specialist: ['í•œì˜ì‚¬', 'ì˜ì‚¬', 'êµìˆ˜', 'ì „ë¬¸ê°€', 'ì•½ì‚¬'],
    health_habit: ['ìŠ¤íŠ¸ë ˆì¹­', 'ìˆ˜ë©´ë²•', 'í˜¸í¡ë²•', 'ì‹ì‚¬ë²•', 'ìš´ë™'],
    number: ['3', '5', '7', '10'],
    vitamin: ['ë¹„íƒ€ë¯¼D', 'ì˜¤ë©”ê°€3', 'ì¹¼ìŠ˜', 'ë§ˆê·¸ë„¤ìŠ˜', 'ì•„ì—°'],
    historical_figure: ['ì„¸ì¢…ëŒ€ì™•', 'ì´ìˆœì‹ ', 'í—ˆì¤€', 'ì •ì•½ìš©', 'ì‹ ì‚¬ì„ë‹¹'],
    event: ['ì‚¬ê±´', 'ë°œëª…', 'ë°œê²¬', 'í˜ëª…', 'ê¸°ì '],
    action: ['ìœ ì–¸', 'ì„ íƒ', 'ê²°ì •', 'ë°œì–¸', 'í–‰ë™'],
    object: ['ë¬¸ì„œ', 'ìœ ë¬¼', 'í¸ì§€', 'ë¹„ì„', 'ê·¸ë¦¼'],
    topic: ['ì˜ë£Œ', 'êµìœ¡', 'ìŒì‹', 'íŒ¨ì…˜', 'ê±´ì¶•'],
    region: ['ì„œìš¸', 'ë¶€ì‚°', 'ëŒ€êµ¬', 'ì¸ì²œ', 'ê´‘ì£¼'],
    historical_event: ['ê´‘ë³µ', 'í•œêµ­ì „ìŸ', 'ìƒˆë§ˆì„ìš´ë™', '88ì˜¬ë¦¼í”½', 'IMF'],
    benefit: ['ë…¸ì¸ëŒë´„ì„œë¹„ìŠ¤', 'ê¸°ì´ˆì—°ê¸ˆ', 'ì—ë„ˆì§€ë°”ìš°ì²˜', 'ê²½ë¡œìš°ëŒ€', 'ê±´ê°•ê²€ì§„'],
    amount: ['ì›” 30ë§Œì›', 'ì—° 100ë§Œì›', '50ë§Œì›', '200ë§Œì›'],
    financial_product: ['ì—°ê¸ˆë³´í—˜', 'ì‹¤ë²„ë³´í—˜', 'ì €ì¶•ë³´í—˜', 'ì£¼íƒì—°ê¸ˆ'],
    asset: ['ë¶€ë™ì‚°', 'ì˜ˆê¸ˆ', 'ì£¼ì‹', 'ì—°ê¸ˆ'],
    income: ['ì›”ì„¸ìˆ˜ì…', 'ë°°ë‹¹ê¸ˆ', 'ì´ììˆ˜ì…', 'ìš©ëˆ'],
    period: ['6ê°œì›”', '1ë…„', '3ë…„'],
    scheme: ['ë³´ì´ìŠ¤í”¼ì‹±', 'íˆ¬ìì‚¬ê¸°', 'ëŒ€ì¶œì‚¬ê¸°', 'í”¼ë¼ë¯¸ë“œ'],
    government_benefit: ['êµ­ë¯¼ì—°ê¸ˆ', 'ê¸°ì´ˆì—°ê¸ˆ', 'ì£¼ê±°ê¸‰ì—¬', 'ì˜ë£Œê¸‰ì—¬'],
    percent: ['50', '30', '70'],
    hobby: ['ì„œì˜ˆ', 'ì‚¬ì§„', 'ë“±ì‚°', 'ë‚šì‹œ', 'ë°”ë‘‘', 'ì›ì˜ˆ', 'ìš”ë¦¬', 'ê·¸ë¦¼'],
    celebrity: ['ì†¡í•´', 'ë‚˜í›ˆì•„', 'ì¡°ìš©í•„', 'ì´ë¯¸ì', 'íŒ¨í‹°ê¹€'],
    place_type: ['ë‘˜ë ˆê¸¸', 'ì˜¨ì²œ', 'ì‚¬ì°°', 'ì „í†µì‹œì¥', 'ìˆ˜ëª©ì›'],
    benefit_hobby: ['ì¹˜ë§¤ ì˜ˆë°©', 'ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ', 'ì²´ë ¥ ì¦ì§„', 'ì‚¬íšŒ í™œë™']
};

// ëœë¤ ê°’ ì„ íƒ
function pickRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

// í…œí”Œë¦¿ì—ì„œ ë™ì  ì£¼ì œ ìƒì„±
function generateDynamicTopic(category, index) {
    const templates = DYNAMIC_TOPIC_TEMPLATES[category];
    const template = pickRandom(templates);

    // í…œí”Œë¦¿ ë³€ìˆ˜ ì¹˜í™˜
    let title = template.replace(/\{(\w+)\}/g, (match, key) => {
        return TOPIC_FILLERS[key] ? pickRandom(TOPIC_FILLERS[key]) : match;
    });

    const icons = {
        story: ['ğŸ’•', 'ğŸ˜¢', 'ğŸ¥¹', 'ğŸ’«', 'ğŸŒŸ', 'ğŸ­', 'ğŸ“–', 'ğŸ’'],
        health: ['ğŸ¦µ', 'ğŸ’ª', 'ğŸƒ', 'ğŸ§˜', 'ğŸ¥—', 'ğŸ’Š', 'ğŸ©º', 'â¤ï¸â€ğŸ©¹'],
        history: ['ğŸ“š', 'ğŸ›ï¸', 'âš”ï¸', 'ğŸ‘‘', 'ğŸ–ï¸', 'ğŸ—¿', 'ğŸ“œ', 'ğŸ”'],
        finance: ['ğŸ’°', 'ğŸ¦', 'ğŸ“ˆ', 'ğŸ’µ', 'ğŸ ', 'ğŸ’³', 'ğŸ”', 'ğŸ’'],
        hobby: ['ğŸµ', 'ğŸ¨', 'ğŸ“·', 'ğŸ¥¾', 'ğŸ£', 'â™Ÿï¸', 'ğŸŒ±', 'âœï¸']
    };

    const reasons = {
        story: ['ì‹œë‹ˆì–´ ì„¸ëŒ€ì˜ ê³µê°ê³¼ í–¥ìˆ˜ë¥¼ ìê·¹í•˜ëŠ” ì£¼ì œì…ë‹ˆë‹¤.', 'ê°ì„±ì ì¸ ìŠ¤í† ë¦¬í…”ë§ìœ¼ë¡œ ë†’ì€ ê³µìœ ìœ¨ì´ ì˜ˆìƒë©ë‹ˆë‹¤.'],
        health: ['ì‹¤ìš©ì ì¸ ê±´ê°• ì •ë³´ë¡œ ì €ì¥ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.', 'ì‹œë‹ˆì–´ ê±´ê°• ê´€ì‹¬ë„ê°€ ë†’ì•„ ì¡°íšŒìˆ˜ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤.'],
        history: ['ì—­ì‚¬ì  í˜¸ê¸°ì‹¬ì„ ìê·¹í•˜ë©° êµìœ¡ì  ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.', 'ì‹œë‹ˆì–´ ì„¸ëŒ€ì˜ ì—­ì‚¬ì— ëŒ€í•œ ê´€ì‹¬ì´ ë†’ìŠµë‹ˆë‹¤.'],
        finance: ['ë…¸í›„ ì¬ì •ì— ëŒ€í•œ ì‹¤ì§ˆì  ì •ë³´ë¡œ ê´€ì‹¬ë„ê°€ ë†’ìŠµë‹ˆë‹¤.', 'ì €ì¥ê³¼ ê³µìœ ê°€ ë§ì•„ ì•Œê³ ë¦¬ì¦˜ì— ìœ ë¦¬í•©ë‹ˆë‹¤.'],
        hobby: ['ì·¨ë¯¸ì™€ ì—¬ê°€ì— ëŒ€í•œ ë‹ˆì¦ˆê°€ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.', 'ê¸ì •ì ì¸ ë¼ì´í”„ìŠ¤íƒ€ì¼ ì½˜í…ì¸ ë¡œ ì¸ê¸°ê°€ ë†’ìŠµë‹ˆë‹¤.']
    };

    const blueOcean = 70 + Math.floor(Math.random() * 25);
    const competitions = ['ë§¤ìš° ë‚®ìŒ', 'ë‚®ìŒ', 'ì¤‘ê°„'];
    const growths = ['ê¸‰ìƒìŠ¹', 'ìƒìŠ¹ì„¸', 'ì•ˆì •ì ', 'í‹ˆìƒˆì‹œì¥', 'ë¸”ë£¨ì˜¤ì…˜'];

    return {
        id: 1000 + index + Math.floor(Math.random() * 1000),
        title: title,
        icon: pickRandom(icons[category]),
        reason: pickRandom(reasons[category]),
        targetAudience: `${pickRandom(['50-65ì„¸', '55-70ì„¸', '60-75ì„¸', '65-80ì„¸'])} ${category === 'story' ? 'ì¶”ì–µì„ ë‚˜ëˆ„ê³  ì‹¶ì€' : category === 'health' ? 'ê±´ê°•ì— ê´€ì‹¬ ìˆëŠ”' : category === 'finance' ? 'ë…¸í›„ ì¤€ë¹„í•˜ëŠ”' : 'ìƒˆë¡œìš´ ê²ƒì„ ë°°ìš°ê³  ì‹¶ì€'} ì‹œë‹ˆì–´`,
        keywords: title.split(' ').filter(w => w.length > 1).slice(0, 5),
        blueOcean: blueOcean,
        competition: pickRandom(competitions),
        views: `${10 + Math.floor(Math.random() * 40)}ë§Œ~${50 + Math.floor(Math.random() * 100)}ë§Œ`,
        revenue: `${40 + Math.floor(Math.random() * 160)}ë§Œ~${200 + Math.floor(Math.random() * 500)}ë§Œì›`,
        growth: pickRandom(growths)
    };
}

// ===== ì£¼ì œ ìƒì„± (Gemini API ì—°ë™) =====
async function generateTopics() {
    const container = document.getElementById('topicsList');
    const btn = document.querySelector('.btn-generate');

    // ë¡œë”© ìƒíƒœ
    container.innerHTML = `
        <div class="loading-topics">
            <div class="loading-spinner">ğŸ”„</div>
            <p>AIê°€ ë‹ˆì¹˜ ì£¼ì œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>
    `;
    if (btn) btn.disabled = true;

    const categoryName = CATEGORY_NAMES[currentCategory] || 'ì‹œë‹ˆì–´';

    try {
        let topics = [];

        // Gemini APIë¡œ ê³ í’ˆì§ˆ ì£¼ì œ ìƒì„±
        if (geminiApiKey) {
            topics = await generateTopicsWithGemini(currentCategory, categoryName);
        }

        // API ì—†ê±°ë‚˜ ì‹¤íŒ¨ì‹œ ê¸°ì¡´ ë¡œì§
        if (topics.length === 0) {
            topics = generateLocalTopics();
        }

        currentTopics = topics.slice(0, 8);
        renderTopics();

    } catch (error) {
        console.error('Topic generation error:', error);
        currentTopics = generateLocalTopics().slice(0, 8);
        renderTopics();
    }

    if (btn) btn.disabled = false;
}

// Gemini APIë¡œ ì£¼ì œ ìƒì„±
async function generateTopicsWithGemini(category, categoryName) {
    // ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆì‹œ ì£¼ì œ
    const categoryExamples = {
        story: `- "ê²°í˜¼ 40ë…„ì°¨, ì•„ë‚´ì—ê²Œ ì°¨ë§ˆ ë§ ëª»í•œ ì´ì•¼ê¸°" (ì‚¬ì—°)
- "6070 ì²«ì‚¬ë‘ ì´ì•¼ê¸°, ê·¸ë•Œ ê·¸ ì‚¬ëŒ ì§€ê¸ˆ ì–´ë””ì—" (ì¶”ì–µ)
- "ì‹œì–´ë¨¸ë‹ˆê°€ ë©°ëŠë¦¬ì—ê²Œ ë‚¨ê¸´ ë§ˆì§€ë§‰ í¸ì§€" (ê°€ì¡±ì‚¬ì—°)`,
        health: `- "60ëŒ€ ë¬´ë¦í†µì¦, ì´ê²ƒë§Œ í•˜ë©´ 1ì£¼ì¼ ë§Œì—..." (ê´€ì ˆ)
- "70ëŒ€ ì•„ë²„ì§€ ì¹˜ë§¤ ì´ˆê¸°ì¦ìƒ, ì´ê±¸ ë†“ì³¤ì–´ìš”" (ë‡Œê±´ê°•)
- "ë‹¹ë‡¨ 10ë…„ì°¨, ì•½ ì—†ì´ í˜ˆë‹¹ ê´€ë¦¬í•˜ëŠ” ë²•" (ë§Œì„±ì§ˆí™˜)`,
        history: `- "6.25ë•Œ í• ì•„ë²„ì§€ê°€ ê²ªì€ ê¸°ì  ê°™ì€ ì´ì•¼ê¸°" (í•œêµ­ì‚¬)
- "ì¡°ì„ ì‹œëŒ€ ì–‘ë°˜ë“¤ì˜ ì¶©ê²©ì ì¸ ë¹„ë°€" (ì•¼ì‚¬)
- "ì¼ì œê°•ì ê¸°, ìš°ë¦¬ ë™ë„¤ ìˆ¨ê²¨ì§„ ì—­ì‚¬" (ê·¼í˜„ëŒ€ì‚¬)`,
        finance: `- "65ì„¸ ì´ìƒ ê¸°ì´ˆì—°ê¸ˆ, ì´ë ‡ê²Œ í•˜ë©´ ë” ë°›ì•„ìš”" (ì—°ê¸ˆ)
- "ì€í‡´ í›„ ì›” 200ë§Œì› ë²„ëŠ” í˜„ì‹¤ì ì¸ ë°©ë²•" (ì¬í…Œí¬)
- "ìë…€ì—ê²Œ ì§‘ ë¬¼ë ¤ì¤„ ë•Œ ì„¸ê¸ˆ ì•„ë¼ëŠ” ë²•" (ìƒì†)`,
        hobby: `- "60ëŒ€ ì‹œì‘í•´ë„ ëŠ¦ì§€ ì•Šì€ ì·¨ë¯¸ 5ê°€ì§€" (ì·¨ë¯¸)
- "ì†ì£¼ì™€ í•¨ê»˜ ë§Œë“œëŠ” ì¶”ì–µ, ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”" (ê°€ì¡±í™œë™)
- "í˜¼ì ì‚¬ëŠ” ì‹œë‹ˆì–´, ì™¸ë¡­ì§€ ì•Šê²Œ ì‚¬ëŠ” ë²•" (ì¼ìƒ)`
    };

    const examples = categoryExamples[category] || categoryExamples.story;

    const prompt = `ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ì‹œë‹ˆì–´ YouTube ì½˜í…ì¸  ì „ëµê°€ì…ë‹ˆë‹¤.

ã€âš ï¸ ì¤‘ìš”: ë°˜ë“œì‹œ "${categoryName}" ë¶„ì•¼ ì£¼ì œë§Œ ìƒì„±í•˜ì„¸ìš”!ã€‘

ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ ì£¼ì œëŠ” ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
- ì‚¬ì—°/ì¶”ì–µ: ê°œì¸ ì‚¬ì—°, ê°€ì¡± ì´ì•¼ê¸°, ì˜›ë‚  ì¶”ì–µ
- ê±´ê°•ì •ë³´: ì§ˆë³‘, í†µì¦, ê±´ê°•ê´€ë¦¬, ìš´ë™
- ì•¼ë‹´/ì—­ì‚¬: í•œêµ­ì‚¬, ì—­ì‚¬ ì´ì•¼ê¸°, ì˜›ë‚ ì•¼ê¸°
- ì¬í…Œí¬: ì—°ê¸ˆ, ì„¸ê¸ˆ, íˆ¬ì, ìƒì†
- ì·¨ë¯¸/ë¬¸í™”: ì·¨ë¯¸í™œë™, ì—¬ê°€, ë¬¸í™”ìƒí™œ

ğŸ¯ í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬: "${categoryName}"

ã€ì´ ì¹´í…Œê³ ë¦¬ì˜ ì„±ê³µ ì‚¬ë¡€ã€‘
${examples}

ã€ìš”êµ¬ì‚¬í•­ã€‘
- "${categoryName}" ë¶„ì•¼ì˜ ë‹ˆì¹˜ ì½˜í…ì¸  ì£¼ì œ 8ê°œ
- 50-70ëŒ€ ì‹œë‹ˆì–´ íƒ€ê²Ÿ
- í´ë¦­í•˜ê³  ì‹¶ì–´ì§€ëŠ” êµ¬ì²´ì ì¸ ì œëª©
- ë¸”ë£¨ì˜¤ì…˜ (ê²½ìŸ ì ìŒ)

ã€JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µã€‘
\`\`\`json
[{
  "title": "${categoryName} ê´€ë ¨ êµ¬ì²´ì  ì œëª©",
  "icon": "ì´ëª¨ì§€",
  "reason": "ë¸”ë£¨ì˜¤ì…˜ì¸ ì´ìœ ",
  "targetAudience": "êµ¬ì²´ì  íƒ€ê²Ÿ",
  "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2", "í‚¤ì›Œë“œ3", "í‚¤ì›Œë“œ4", "í‚¤ì›Œë“œ5"],
  "blueOcean": 80,
  "competition": "ë‚®ìŒ",
  "views": "ì›” 10ë§Œ~30ë§Œ",
  "revenue": "ì›” 50ë§Œ~150ë§Œì›",
  "growth": "ê¸‰ìƒìŠ¹ ì¤‘"
}]
\`\`\`

âš ï¸ "${categoryName}" ì¹´í…Œê³ ë¦¬ ì£¼ì œë§Œ ì¶œë ¥í•˜ì„¸ìš”. JSON ë°°ì—´ë§Œ:`;

    try {
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.9, maxOutputTokens: 2048 }
                })
            }
        );

        if (!response.ok) throw new Error('Gemini API ì˜¤ë¥˜');

        const data = await response.json();
        const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';

        const jsonMatch = text.match(/\[[\s\S]*\]/);
        if (jsonMatch) {
            const topics = JSON.parse(jsonMatch[0]);
            return topics.map((t, i) => ({
                id: 2000 + i,
                title: t.title,
                icon: t.icon || 'ğŸ“Œ',
                reason: t.reason,
                targetAudience: t.targetAudience,
                keywords: t.keywords || [],
                blueOcean: t.blueOcean || 80,
                competition: t.competition || 'ë‚®ìŒ',
                views: t.views || '10ë§Œ~30ë§Œ',
                revenue: t.revenue || '50ë§Œ~150ë§Œì›',
                growth: t.growth || 'ì•ˆì •ì ',
                isAI: true
            }));
        }
    } catch (error) {
        console.warn('Gemini ì£¼ì œ ìƒì„± ì‹¤íŒ¨:', error);
    }

    return [];
}

// ë¡œì»¬ ì£¼ì œ ìƒì„± (í´ë°±)
function generateLocalTopics() {
    let topics = [];
    const categories = ['story', 'health', 'history', 'finance', 'hobby'];

    if (currentCategory === 'all') {
        categories.forEach((cat, catIndex) => {
            const catTopics = topicsDatabase[cat];
            if (catTopics && catTopics.length > 0) {
                const randomExisting = catTopics[Math.floor(Math.random() * catTopics.length)];
                topics.push(randomExisting);
            }
            topics.push(generateDynamicTopic(cat, catIndex));
        });
    } else if (topicsDatabase[currentCategory]) {
        const catTopics = [...topicsDatabase[currentCategory]];
        const shuffled = catTopics.sort(() => Math.random() - 0.5);
        topics.push(...shuffled.slice(0, 3));

        for (let i = 0; i < 5; i++) {
            topics.push(generateDynamicTopic(currentCategory, i));
        }
    } else {
        topics = topicsDatabase[currentCategory] || [];
    }

    return topics.sort(() => Math.random() - 0.5);
}

// ===== ì£¼ì œ ë Œë”ë§ =====
function renderTopics() {
    const container = document.getElementById('topicsList');

    const categoryNames = {
        story: 'ì‚¬ì—°/ì¶”ì–µ',
        health: 'ê±´ê°•ì •ë³´',
        history: 'ì•¼ë‹´/ì—­ì‚¬',
        finance: 'ì¬í…Œí¬',
        hobby: 'ì·¨ë¯¸/ë¬¸í™”'
    };

    container.innerHTML = currentTopics.map((topic, index) => {
        const category = getCategoryFromId(topic.id);
        return `
            <div class="topic-item" onclick="selectTopic(${index})" data-index="${index}">
                <div class="topic-icon">${topic.icon}</div>
                <div class="topic-info">
                    <div class="topic-title">${topic.title}</div>
                    <div class="topic-meta">
                        <span class="topic-category-tag">${categoryNames[category]}</span>
                        <span class="topic-score">ğŸ”¥ ${topic.blueOcean}ì </span>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

// ===== IDë¡œ ì¹´í…Œê³ ë¦¬ ì°¾ê¸° =====
function getCategoryFromId(id) {
    if (id < 10) return 'story';
    if (id < 20) return 'health';
    if (id < 30) return 'history';
    if (id < 40) return 'finance';
    return 'hobby';
}

// ===== ì£¼ì œ ì„ íƒ =====
function selectTopic(index) {
    selectedTopic = currentTopics[index];

    // í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.topic-item').forEach((item, i) => {
        item.classList.toggle('active', i === index);
    });

    // ë¹ˆ ìƒíƒœ ìˆ¨ê¸°ê¸°
    document.getElementById('emptyState').style.display = 'none';

    // íŒ¨ë„ë“¤ ë³´ì´ê¸°
    document.getElementById('selectedTopicPanel').style.display = 'block';
    document.getElementById('revenuePanel').style.display = 'block';
    document.getElementById('contentPanel').style.display = 'block';

    // ì •ë³´ ì—…ë°ì´íŠ¸
    updateSelectedTopicInfo();
    updateRevenueInfo();
    generateScript();
}

// ===== ì„ íƒëœ ì£¼ì œ ì •ë³´ ì—…ë°ì´íŠ¸ =====
function updateSelectedTopicInfo() {
    const categoryNames = {
        story: 'ì‚¬ì—°/ì¶”ì–µ',
        health: 'ê±´ê°•ì •ë³´',
        history: 'ì•¼ë‹´/ì—­ì‚¬',
        finance: 'ì¬í…Œí¬',
        hobby: 'ì·¨ë¯¸/ë¬¸í™”'
    };

    const category = currentCategory;

    document.getElementById('selectedCategory').textContent = categoryNames[category];
    document.getElementById('selectedTitle').textContent = selectedTopic.title;
    document.getElementById('blueOceanScore').textContent = selectedTopic.blueOcean;
    document.getElementById('competitionScore').textContent = selectedTopic.competition;
    document.getElementById('topicReason').textContent = selectedTopic.reason;
    document.getElementById('targetAudience').textContent = selectedTopic.targetAudience;

    // í‚¤ì›Œë“œ ë Œë”ë§
    document.getElementById('keywordsList').innerHTML = selectedTopic.keywords
        .map(kw => `<span class="keyword-tag">#${kw}</span>`)
        .join('');
}

// ===== ìˆ˜ìµ ì •ë³´ ì—…ë°ì´íŠ¸ =====
function updateRevenueInfo() {
    document.getElementById('expectedViews').textContent = selectedTopic.views;
    document.getElementById('expectedRevenue').textContent = selectedTopic.revenue;
    document.getElementById('growthPotential').textContent = selectedTopic.growth;
}

// ===== ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (Gemini API ì—°ë™) =====
async function generateScript() {
    const container = document.getElementById('scriptContent');
    container.innerHTML = '<div class="script-loading">ğŸ”„ AIê°€ ê³ í’ˆì§ˆ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...</div>';

    const category = currentCategory;

    try {
        let script = '';

        // Gemini APIë¡œ ê³ í’ˆì§ˆ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        if (geminiApiKey) {
            script = await generateScriptWithGemini(category);
        }

        // API ì—†ê±°ë‚˜ ì‹¤íŒ¨ì‹œ ê¸°ì¡´ ë¡œì§
        if (!script) {
            if (currentContentType === 'shorts') {
                script = generateLocalShortsScript(category);
            } else {
                script = generateLocalLongScript(category);
            }
        }

        document.getElementById('scriptContent').textContent = script;
        await generateThumbnailsWithAI();
        // ìŠ¤í¬ë¦½íŠ¸ ì €ì¥
        setTimeout(saveCurrentState, 500);

    } catch (error) {
        console.error('Script generation error:', error);
        const fallbackScript = currentContentType === 'shorts'
            ? generateLocalShortsScript(category)
            : generateLocalLongScript(category);
        document.getElementById('scriptContent').textContent = fallbackScript;
        generateThumbnails();
    }
}

// Gemini APIë¡œ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
async function generateScriptWithGemini(category) {
    const contentType = currentContentType === 'shorts' ? '3ë¶„ ì‡¼ì¸ ' : '10ë¶„ ë¡±í¼';
    const categoryName = CATEGORY_NAMES[category] || 'ì‹œë‹ˆì–´';

    // ì‚¬ì—°/ê±´ê°• ì¹´í…Œê³ ë¦¬ëŠ” ë‚­ë… í˜•ì‹ (ê°€ìƒ ì¸ë¬¼ ì‚¬ì—°)
    const isNarrationStyle = ['story', 'health'].includes(category);

    const shortsPrompt = isNarrationStyle ?
        `ë‹¹ì‹ ì€ ì‹œë‹ˆì–´ ì‚¬ì—° ë‚­ë… ì±„ë„ì˜ ìŠ¤í† ë¦¬ ì‘ê°€ì…ë‹ˆë‹¤.
"${selectedTopic.title}" ì£¼ì œë¡œ 50ëŒ€ ì´ìƒ ì‹œì²­ìê°€ ëª°ì…í•  ìˆ˜ ìˆëŠ” ì‚¬ì—° ë‚­ë… ìŠ¤í¬ë¦½íŠ¸(3ë¶„)ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

ã€í•µì‹¬: ì‚¬ì‹¤ ê¸°ë°˜ ê°€ìƒ ìŠ¤í† ë¦¬ã€‘
ì‹¤ì œ ìˆì„ ë²•í•œ ì´ì•¼ê¸°ë¥¼ ê°€ìƒì˜ ì¸ë¬¼ë¡œ ìƒìƒí•˜ê²Œ êµ¬ì„±í•©ë‹ˆë‹¤.
- ê°€ìƒ ì¸ë¬¼: êµ¬ì²´ì ì¸ ì´ë¦„, ë‚˜ì´(50-70ëŒ€), ì§ì—…, ê°€ì¡±ê´€ê³„
- ë°°ê²½: ì‹¤ì œ í•œêµ­ ì§€ì—­ëª…, ì—°ë„, ê³„ì ˆ
- ìƒí™©: ëˆ„êµ¬ë‚˜ ê³µê°í•  ìˆ˜ ìˆëŠ” í˜„ì‹¤ì ì¸ ìƒí™©

ã€50ëŒ€ ì´ìƒì´ ì¢‹ì•„í•˜ëŠ” ìŠ¤í† ë¦¬ êµ¬ì¡°ã€‘

1. ë„ì… (20ì´ˆ) - ì‹œì²­ì ê´€ì‹¬ ëŒê¸°
   "ì˜¤ëŠ˜ ì†Œê°œí•´ë“œë¦´ ì‚¬ì—°ì€ ì •ë§ íŠ¹ë³„í•´ìš”.
   â—‹â—‹ì‹œì— ì‚¬ì‹œëŠ” â—‹â—‹ì‚´ â—‹â—‹â—‹ ë‹˜ ì´ì•¼ê¸°ì¸ë°ìš”..."

2. ë°°ê²½ ì„¤ëª… (30ì´ˆ) - ì£¼ì¸ê³µ ì†Œê°œ
   "ì €ëŠ” ì˜¬í•´ â—‹â—‹ì‚´ì´ì—ìš”.
   ë‚¨í¸/ì•„ë‚´ì™€ â—‹â—‹ë…„ì§¸ í•¨ê»˜ ì‚´ê³  ìˆì–´ìš”..."

3. ì‚¬ê±´ ì „ê°œ (60ì´ˆ) - ê¸´ì¥ê° ìˆëŠ” ì´ì•¼ê¸°
   "ê·¸ëŸ°ë° ì–´ëŠ ë‚ ..."
   (ê°ˆë“±, ë¬¸ì œ, ìœ„ê¸° ìƒí™©)

4. ë°˜ì „/í´ë¼ì´ë§¥ìŠ¤ (40ì´ˆ) - ê°ë™ í¬ì¸íŠ¸
   "ê·¸ë•Œ â—‹â—‹â—‹ê°€ í•œ ë§ì´..."
   (ëˆˆë¬¼, ê°ë™, ê¹¨ë‹¬ìŒ)

5. ë§ˆë¬´ë¦¬ (30ì´ˆ) - êµí›ˆê³¼ ì—¬ìš´
   "ê·¸ ì´í›„ë¡œ ì €ëŠ”..."
   + ë”°ëœ»í•œ ì¸ì‚¬

ã€í•„ìˆ˜ ê·œì¹™ã€‘
âœ… ~í•´ìš”ì²´, í• ë¨¸ë‹ˆ/í• ì•„ë²„ì§€ê°€ ì´ì•¼ê¸°í•˜ë“¯
âœ… êµ¬ì²´ì ì¸ ëŒ€í™” ì¥ë©´ í¬í•¨ (""ë¡œ í‘œì‹œ)
âœ… ê°ì • ë³€í™”: í‰í™”â†’ ê°ˆë“±â†’ ê°ë™â†’ ì—¬ìš´
âœ… ì‹œë‹ˆì–´ê°€ ê³µê°í•˜ëŠ” ì†Œì¬: ê°€ì¡±, ê±´ê°•, ì˜›ë‚ , ì†ì£¼
âŒ [ë„ì…], [ì „ê°œ] ê°™ì€ êµ¬ì¡° í‘œì‹œ ê¸ˆì§€
âŒ ì‹œê°„ í‘œì‹œ ê¸ˆì§€

ã€ì£¼ì œã€‘ ${selectedTopic.title}

íƒ€ì…ìºìŠ¤íŠ¸ì— ë°”ë¡œ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆëŠ” ê¹¨ë—í•œ ë‚­ë… ëŒ€ë³¸ë§Œ ì‘ì„±í•˜ì„¸ìš”:` :

        `ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ì‹œë‹ˆì–´ ìœ íŠœë¸Œ ì „ë¬¸ ì‘ê°€ì…ë‹ˆë‹¤.
"${selectedTopic.title}" ì£¼ì œë¡œ 3ë¶„ ë¶„ëŸ‰ì˜ ì‡¼ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

ã€í˜•ì‹: íƒ€ì…ìºìŠ¤íŠ¸ TTSìš© - ê¹¨ë—í•œ ëŒ€ë³¸ë§Œ ì¶œë ¥ã€‘

ã€í•„ìˆ˜ ê·œì¹™ã€‘
âœ… ~í•´ìš”ì²´ ì‚¬ìš©(ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì–´íˆ¬)
âœ… 50-70ëŒ€ ì‹œë‹ˆì–´ê°€ 100% ì´í•´í•  ìˆ˜ ìˆëŠ” ì‰¬ìš´ ë‹¨ì–´
âœ… ìì—°ìŠ¤ëŸ¬ìš´ ë§íˆ¬ë¡œ í˜ëŸ¬ê°€ë“¯
âŒ[í›…], [ì „ê°œ] ê°™ì€ êµ¬ì¡° í‘œì‹œ ê¸ˆì§€
âŒ "3ì´ˆ", "25ì´ˆ" ê°™ì€ ì‹œê°„ í‘œì‹œ ê¸ˆì§€
âŒ ê´„í˜¸ ì•ˆ ì„¤ëª… ê¸ˆì§€
âŒ AIìŠ¤ëŸ¬ìš´ ë”±ë”±í•œ ë¬¸ì²´ ê¸ˆì§€

ã€ëŒ€ë³¸ íë¦„ã€‘
    1. ì²« ë¬¸ì¥: ì‹œì²­ìê°€ ë©ˆì¶°ì„œ ë“£ê²Œ ë§Œë“œëŠ” ì¶©ê²©ì ì¸ í•œ ë¬¸ì¥
    2. ì¤‘ë°˜: ê³µê° â†’ ë¬¸ì œ ì œê¸° â†’ í•´ê²°ì±… / ì •ë³´
    3. ë§ˆë¬´ë¦¬: ë”°ëœ»í•œ ì‘ì› + êµ¬ë… ìœ ë„

    íƒ€ê²Ÿ: ${selectedTopic.targetAudience || '50-70ëŒ€ ì‹œë‹ˆì–´'}
    í‚¤ì›Œë“œ: ${selectedTopic.keywords?.join(', ') || 'ì‹œë‹ˆì–´, ê±´ê°•, í–‰ë³µ'}

íƒ€ì…ìºìŠ¤íŠ¸ì— ë°”ë¡œ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆëŠ” ê¹¨ë—í•œ ëŒ€ë³¸ë§Œ ì‘ì„±í•˜ì„¸ìš”: `;

    const longPrompt = isNarrationStyle ?
        `ë‹¹ì‹ ì€ ì‹œë‹ˆì–´ ì‚¬ì—° ë‚­ë… ì±„ë„ì˜ ìŠ¤í† ë¦¬ ì‘ê°€ì…ë‹ˆë‹¤.
"${selectedTopic.title}" ì£¼ì œë¡œ 50ëŒ€ ì´ìƒ ì‹œì²­ìê°€ ëê¹Œì§€ ëª°ì…í•  ìˆ˜ ìˆëŠ” ì‚¬ì—° ë‚­ë… ìŠ¤í¬ë¦½íŠ¸(10ë¶„)ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

ã€í•µì‹¬: ì‚¬ì‹¤ ê¸°ë°˜ ê°€ìƒ ìŠ¤í† ë¦¬ã€‘
ì‹¤ì œ ìˆì„ ë²•í•œ ì´ì•¼ê¸°ë¥¼ ê°€ìƒì˜ ì¸ë¬¼ë¡œ ìƒìƒí•˜ê²Œ êµ¬ì„±í•©ë‹ˆë‹¤.
- ê°€ìƒ ì¸ë¬¼: êµ¬ì²´ì ì¸ ì´ë¦„, ë‚˜ì´(50-70ëŒ€), ì§ì—…, ê°€ì¡±ê´€ê³„
- ë°°ê²½: ì‹¤ì œ í•œêµ­ ì§€ì—­ëª…, ì—°ë„(1970~2020ë…„ëŒ€), ê³„ì ˆ
- ìƒí™©: ëˆ„êµ¬ë‚˜ ê³µê°í•  ìˆ˜ ìˆëŠ” í˜„ì‹¤ì ì¸ ìƒí™©

ã€50ëŒ€ ì´ìƒì´ ì¢‹ì•„í•˜ëŠ” 10ë¶„ ìŠ¤í† ë¦¬ êµ¬ì¡°ã€‘

[ì˜¤í”„ë‹] (30ì´ˆ)
"ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ë„ ì°¾ì•„ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”.
ì˜¤ëŠ˜ì€ ì •ë§ íŠ¹ë³„í•œ ì‚¬ì—°ì„ í•˜ë‚˜ ì½ì–´ë“œë¦´ê²Œìš”.
â—‹â—‹ì‹œì— ì‚¬ì‹œëŠ” â—‹â—‹ì‚´ â—‹â—‹â—‹ ë‹˜ ì´ì•¼ê¸°ì˜ˆìš”..."

[1ë§‰: í‰í™”ë¡œìš´ ì¼ìƒ] (2ë¶„)
- ì£¼ì¸ê³µì˜ ì‚¶ ì†Œê°œ
- ê°€ì¡± ê´€ê³„, ì§ì—…, ì¼ìƒ
- "ì €ëŠ” ì˜¬í•´ â—‹â—‹ì‚´ì´ì—ìš”. â—‹â—‹ë…„ ì „ ì´ì•¼ê¸°ì¸ë°ìš”..."

[2ë§‰: ì‚¬ê±´ê³¼ ê°ˆë“±] (3ë¶„)
- "ê·¸ëŸ°ë° ì–´ëŠ ë‚ ..."
- ì˜ˆìƒì¹˜ ëª»í•œ ì‚¬ê±´ ë°œìƒ
- ê°ˆë“±, ì˜¤í•´, ìœ„ê¸°
- ê¸´ì¥ê° ê³ ì¡°

[3ë§‰: ë°˜ì „ê³¼ ê°ë™] (3ë¶„)
- ìˆ¨ê²¨ì§„ ì§„ì‹¤ ê³µê°œ
- ê°€ìŠ´ ì°¡í•œ ë°˜ì „
- ëˆˆë¬¼ ë‚˜ëŠ” ëŒ€í™” ì¥ë©´
- "ê·¸ë•Œ â—‹â—‹â—‹ê°€ ì œê²Œ ì´ë ‡ê²Œ ë§í–ˆì–´ìš”..."

[ì—í•„ë¡œê·¸] (1ë¶„ 30ì´ˆ)
- ê·¸ í›„ ë³€í™”ëœ ì‚¶
- ì–»ì€ êµí›ˆ
- ì‹œì²­ìì—ê²Œ ì „í•˜ëŠ” ë©”ì‹œì§€
- ë”°ëœ»í•œ ë§ˆë¬´ë¦¬ ì¸ì‚¬

ã€í•„ìˆ˜ ê·œì¹™ã€‘
âœ… ~í•´ìš”ì²´, í• ë¨¸ë‹ˆ/í• ì•„ë²„ì§€ê°€ ì´ì•¼ê¸°í•˜ë“¯ ìì—°ìŠ¤ëŸ½ê²Œ
âœ… êµ¬ì²´ì ì¸ ëŒ€í™” ì¥ë©´ ë§ì´ í¬í•¨ (""ë¡œ í‘œì‹œ)
âœ… ê°ì • ë³€í™”: í‰í™”â†’ ì‚¬ê±´â†’ ê°ˆë“±â†’ ê°ë™â†’ ì—¬ìš´
âœ… ì‹œë‹ˆì–´ê°€ ê³µê°í•˜ëŠ” ì†Œì¬: ê°€ì¡±, ê±´ê°•, ì˜›ë‚ , ìë…€, ì†ì£¼
âœ… ì¤‘ê°„ì¤‘ê°„ "ì—¬ëŸ¬ë¶„ë„ ê·¸ëŸ° ì  ìˆìœ¼ì‹œì£ ?" ê°™ì€ ê³µê° ìœ ë„
âŒ [1ë§‰], [ì—í•„ë¡œê·¸] ê°™ì€ êµ¬ì¡° í‘œì‹œ ê¸ˆì§€
âŒ ì‹œê°„ í‘œì‹œ ê¸ˆì§€
âŒ ê´„í˜¸ ì•ˆ ì„¤ëª… ê¸ˆì§€

ã€ì£¼ì œã€‘ ${selectedTopic.title}

íƒ€ì…ìºìŠ¤íŠ¸ì— ë°”ë¡œ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆëŠ” ê¹¨ë—í•œ ë‚­ë… ëŒ€ë³¸ë§Œ ì‘ì„±í•˜ì„¸ìš”:` :

        `ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ì‹œë‹ˆì–´ ìœ íŠœë¸Œ ì „ë¬¸ ì‘ê°€ì…ë‹ˆë‹¤.
"${selectedTopic.title}" ì£¼ì œë¡œ 10ë¶„ ë¡±í¼ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

ã€í˜•ì‹: íƒ€ì…ìºìŠ¤íŠ¸ TTSìš© - ê¹¨ë—í•œ ëŒ€ë³¸ë§Œ ì¶œë ¥ã€‘

ã€í•„ìˆ˜ ê·œì¹™ã€‘
âœ… ~í•´ìš”ì²´, ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì–´íˆ¬
âœ… 50 - 70ëŒ€ ì‹œë‹ˆì–´ê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ì‰¬ìš´ ë‹¨ì–´
âœ… ìˆ¨ ì‰¬ëŠ” ê³³ì— ...í‘œì‹œ
âœ… ë¬¸ë‹¨ ì‚¬ì´ì— ë¹ˆ ì¤„ë¡œ êµ¬ë¶„
âŒ[ì¸íŠ¸ë¡œ], [ë³¸ë¡ ] ê°™ì€ êµ¬ì¡° í‘œì‹œ ê¸ˆì§€
âŒ "30ì´ˆ", "1ë¶„" ê°™ì€ ì‹œê°„ í‘œì‹œ ê¸ˆì§€
âŒ ê´„í˜¸ ì•ˆ ì„¤ëª… ê¸ˆì§€

ã€ëŒ€ë³¸ íë¦„ã€‘
    1. ì¸ì‚¬ì™€ ì˜¤ëŠ˜ ì£¼ì œ ì†Œê°œ
    2. ì‹œì²­ì ê³µê° ìœ ë„
    3. ì²« ë²ˆì§¸ í•µì‹¬ ì •ë³´
    4. ë‘ ë²ˆì§¸ í•µì‹¬ ì •ë³´
    5. ì„¸ ë²ˆì§¸ í•µì‹¬ ì •ë³´
    6. ì •ë¦¬ì™€ ë§ˆë¬´ë¦¬ ì¸ì‚¬

    íƒ€ê²Ÿ: ${selectedTopic.targetAudience || '50-70ëŒ€ ì‹œë‹ˆì–´'}
    í‚¤ì›Œë“œ: ${selectedTopic.keywords?.join(', ') || 'ì‹œë‹ˆì–´, ê±´ê°•, í–‰ë³µ'}

íƒ€ì…ìºìŠ¤íŠ¸ì— ë°”ë¡œ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆëŠ” ê¹¨ë—í•œ ëŒ€ë³¸ë§Œ ì‘ì„±í•˜ì„¸ìš”: `;

    const prompt = currentContentType === 'shorts' ? shortsPrompt : longPrompt;

    try {
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.85,
                        maxOutputTokens: currentContentType === 'shorts' ? 2000 : 3000,
                        topP: 0.9
                    }
                })
            }
        );

        if (!response.ok) throw new Error('Gemini API ì˜¤ë¥˜');

        const data = await response.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || '';

    } catch (error) {
        console.warn('Gemini ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
        return '';
    }
}

// AI ì¸ë„¤ì¼ ì œì•ˆ
async function generateThumbnailsWithAI() {
    if (!geminiApiKey) {
        generateThumbnails();
        return;
    }

    try {
        const prompt = `"${selectedTopic.title}" ì£¼ì œì˜ YouTube ì¸ë„¤ì¼ ë¬¸êµ¬ 4ê°œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.
í´ë¦­ì„ ìœ ë„í•˜ëŠ” ê°•ë ¥í•œ ë¬¸êµ¬ë¡œ, ê° ë¬¸êµ¬ëŠ” 10ì ì´ë‚´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
JSON ë°°ì—´ë¡œë§Œ ì‘ë‹µ: ["ë¬¸êµ¬1", "ë¬¸êµ¬2", "ë¬¸êµ¬3", "ë¬¸êµ¬4"]`;

        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.9 }
                })
            }
        );

        const data = await response.json();
        const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
        const jsonMatch = text.match(/\[[\s\S]*\]/);

        if (jsonMatch) {
            const thumbnails = JSON.parse(jsonMatch[0]);
            document.getElementById('thumbnailSuggestions').innerHTML = thumbnails
                .map(t => `<div class="thumb-item">${t}</div>`)
                .join('');
            return;
        }
    } catch (error) {
        console.warn('AI ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨:', error);
    }

    generateThumbnails();
}

// ===== AI ì¸ë„¤ì¼ ì´ë¯¸ì§€ ìƒì„± (ë‚˜ë…¸ ë°”ë‚˜ë‚˜ í”„ë¡œ) =====
let generatedThumbnailUrl = null;

async function generateAIThumbnail() {
    if (!selectedTopic) {
        showToast('âš ï¸ ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    if (!geminiApiKey) {
        showToast('âš ï¸ Gemini API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
        return;
    }

    const btn = document.getElementById('btnGenerateThumbnail');
    const preview = document.getElementById('thumbnailPreview');
    const actions = document.getElementById('thumbnailActions');

    btn.disabled = true;
    btn.innerHTML = '<span class="thumb-gen-icon">ğŸ”„</span> ì¸ë„¤ì¼ ìƒì„± ì¤‘...';

    preview.innerHTML = `
        <div class="thumbnail-loading">
            <div class="loading-spinner">ğŸ¨</div>
            <p>AIê°€ ì¸ë„¤ì¼ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...<br>ì•½ 10-20ì´ˆ ì†Œìš”</p>
        </div>
    `;
    actions.style.display = 'none';

    const categoryName = CATEGORY_NAMES[getCategoryFromId(selectedTopic.id)] || 'ì‹œë‹ˆì–´';

    // ì¸ë„¤ì¼ìš© ì§§ì€ í…ìŠ¤íŠ¸ ì¶”ì¶œ (10ì ì´ë‚´)
    const shortTitle = selectedTopic.title.split(',')[0].split(' ').slice(0, 3).join(' ');
    const clickbaitText = shortTitle.length > 12 ? shortTitle.substring(0, 12) + '...' : shortTitle;

    // ê³ í’ˆì§ˆ ì¸ë„¤ì¼ í”„ë¡¬í”„íŠ¸ (ë‚˜ë…¸ ë°”ë‚˜ë‚˜ í”„ë¡œ ìµœì í™” + í…ìŠ¤íŠ¸ í¬í•¨)
    const prompt = `Create a professional YouTube thumbnail image with Korean text.

        Topic: "${selectedTopic.title}"
    Category: ${categoryName}
Target audience: Korean seniors(50 - 70 years old)

    IMPORTANT - INCLUDE THIS TEXT IN THE IMAGE:
Main headline(large, bold, Korean): "${clickbaitText}"
Place the text prominently in the center or upper area of the image.
Text should be highly readable with:
    - Large bold font(at least 72pt equivalent)
        - White or yellow color with dark outline / shadow
            - High contrast against background

STYLE REQUIREMENTS:
    - Professional YouTube thumbnail layout(16: 9 ratio)
        - Warm color palette(orange, gold, warm tones)
            - Eye - catching design that makes viewers want to click
                - Emotional imagery related to seniors

VISUAL ELEMENTS:
    - Relevant background image for the topic
        - Gradient overlay to make text pop
            - Emotional appeal(trust, warmth, curiosity)
                - Similar style to successful Korean senior YouTube channels

The text "${clickbaitText}" must be clearly visible and readable.`;

    try {
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent?key=${geminiApiKey}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        responseModalities: ["TEXT", "IMAGE"],
                        imageConfig: {
                            aspectRatio: "16:9",
                            imageSize: "1K"
                        }
                    }
                })
            }
        );

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error?.message || 'API ì˜¤ë¥˜');
        }

        const data = await response.json();

        // ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ
        const parts = data.candidates?.[0]?.content?.parts || [];
        let imageData = null;

        for (const part of parts) {
            if (part.inlineData?.mimeType?.startsWith('image/')) {
                imageData = part.inlineData;
                break;
            }
        }

        if (imageData) {
            generatedThumbnailUrl = `data:${imageData.mimeType};base64,${imageData.data}`;
            preview.innerHTML = `<img src="${generatedThumbnailUrl}" alt="ìƒì„±ëœ ì¸ë„¤ì¼">`;
            actions.style.display = 'flex';
            showToast('âœ… ì¸ë„¤ì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
            // ì¸ë„¤ì¼ ì €ì¥
            setTimeout(saveCurrentState, 500);
        } else {
            throw new Error('ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }

    } catch (error) {
        console.error('ì¸ë„¤ì¼ ìƒì„± ì˜¤ë¥˜:', error);

        // í´ë°±: Geminië¡œ ì¸ë„¤ì¼ ì„¤ëª… ìƒì„± í›„ í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ
        preview.innerHTML = `
            <div class="thumbnail-placeholder">
                <span>âš ï¸</span>
                <p>ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨<br><small>${error.message}</small></p>
            </div>
        `;
        showToast(`âŒ ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨: ${error.message}`);
    }

    btn.disabled = false;
    btn.innerHTML = '<span class="thumb-gen-icon">âœ¨</span> ì¸ë„¤ì¼ ì´ë¯¸ì§€ ìƒì„±';
}

// ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ
function downloadThumbnail() {
    if (!generatedThumbnailUrl) {
        showToast('âš ï¸ ë‹¤ìš´ë¡œë“œí•  ì¸ë„¤ì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }

    const link = document.createElement('a');
    link.href = generatedThumbnailUrl;
    link.download = `thumbnail_${Date.now()}.png`;
    link.click();
    showToast('ğŸ“¥ ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!');
}

// ===== ì‡¼ì¸  ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (ë¡œì»¬) =====
function generateLocalShortsScript(category) {
    const hooks = {
        story: [
            `"${selectedTopic.title.split(',')[0]}..."`,
            `"ì´ ì´ì•¼ê¸°ë¥¼ ë“¤ìœ¼ë©´ ëˆˆë¬¼ì´ ë‚  ìˆ˜ë„ ìˆì–´ìš”"`,
            `"ì˜¤ëŠ˜ ì´ì•¼ê¸°, ì œ ì¸ìƒì—ì„œ ê°€ì¥ ìŠì„ ìˆ˜ ì—†ëŠ” ìˆœê°„ì…ë‹ˆë‹¤"`
        ],
        health: [
            `"ì €ë„ ì´ê±¸ ëª°ë¼ì„œ 10ë…„ì„ ê³ ìƒí–ˆì–´ìš”"`,
            `"ë³‘ì›ì—ì„œ ì ˆëŒ€ ì•ˆ ì•Œë ¤ì£¼ëŠ” ë°©ë²•ì…ë‹ˆë‹¤"`,
            `"ë”± 5ë¶„ë§Œ íˆ¬ìí•˜ì„¸ìš”, ì¸ìƒì´ ë°”ë€ë‹ˆë‹¤"`
        ],
        history: [
            `"ì´ ì´ì•¼ê¸°, ì—­ì‚¬ì±…ì—ëŠ” ì—†ìŠµë‹ˆë‹¤"`,
            `"ì•Œê³  ë‚˜ë©´ ì†Œë¦„ ë‹ëŠ” ì´ì•¼ê¸°ì…ë‹ˆë‹¤"`,
            `"ìš°ë¦¬ê°€ ëª°ëë˜ ì—­ì‚¬ ì† ë¹„ë°€..."`
        ],
        finance: [
            `"ì´ê²ƒë§Œ ì•Œì•˜ì–´ë„ ë…¸í›„ê°€ ë‹¬ë¼ì¡Œì„ í…ë°"`,
            `"ì€í–‰ì—ì„œ ì ˆëŒ€ ì•ˆ ì•Œë ¤ì£¼ëŠ” ë°©ë²•"`,
            `"60ëŒ€ë¼ë©´ ì´ê±´ ê¼­ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤"`
        ],
        hobby: [
            `"ì´ë ‡ê²Œ ì‚´ë©´ 100ì„¸ê¹Œì§€ í–‰ë³µí•©ë‹ˆë‹¤"`,
            `"ì˜›ë‚ ì´ ê·¸ë¦¬ì›Œì§€ëŠ” ë¶„ë“¤ ì£¼ëª©í•˜ì„¸ìš”"`,
            `"ë‚˜ì´ ë“¤ìˆ˜ë¡ ì´ê²Œ í–‰ë³µì˜ ë¹„ê²°ì´ì—ìš”"`
        ]
    };

    const hook = hooks[category][Math.floor(Math.random() * hooks[category].length)];

    return `[HOOK - ì²« 3ì´ˆê°€ ìŠ¹ë¶€!]
${hook}

[ì „ê°œ - 3~30ì´ˆ]
${selectedTopic.title}

${selectedTopic.reason.substring(0, 100)}...

[í•µì‹¬ ë©”ì‹œì§€ - 30~50ì´ˆ]
${selectedTopic.keywords.slice(0, 3).map(k => `#${k}`).join(' ')}

ì´ì•¼ê¸°ì˜ í•µì‹¬ì„ ì—¬ê¸°ì„œ ì „ë‹¬í•©ë‹ˆë‹¤.
ê°ì •ì„ ìê·¹í•˜ëŠ” í‘œí˜„ì„ ì‚¬ìš©í•˜ì„¸ìš”.

[ë§ˆë¬´ë¦¬ - 50~60ì´ˆ]
ì´ëŸ° ì´ì•¼ê¸° ë” ë³´ê³  ì‹¶ìœ¼ì‹œë©´
êµ¬ë…ê³¼ ì¢‹ì•„ìš” ë¶€íƒë“œë ¤ìš” ğŸ’•

ë‹¤ìŒ ì´ì•¼ê¸°ë„ ê¸°ëŒ€í•´ì£¼ì„¸ìš”!`;
}

// ===== ë¡±í¼ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (ë¡œì»¬) =====
function generateLocalLongScript(category) {
    return `[ì¸íŠ¸ë¡œ - 0~30ì´ˆ]
ì•ˆë…•í•˜ì„¸ìš”, ë°˜ê°‘ìŠµë‹ˆë‹¤.
ì˜¤ëŠ˜ì€ "${selectedTopic.title}"ì— ëŒ€í•´ ì´ì•¼ê¸°í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.

[ì™œ ì´ ì£¼ì œì¸ê°€ - 30ì´ˆ~2ë¶„]
${selectedTopic.reason}

[íƒ€ê²Ÿ ì‹œì²­ì]
${selectedTopic.targetAudience}

[ë³¸ë¡  1 - 2ë¶„~4ë¶„]
ì²« ë²ˆì§¸ë¡œ ì•Œì•„ë³¼ ë‚´ìš©ì€...
(ì—¬ê¸°ì— ì²« ë²ˆì§¸ í•µì‹¬ ë‚´ìš©ì„ ìì„¸íˆ í’€ì–´ì£¼ì„¸ìš”)

[ë³¸ë¡  2 - 4ë¶„~6ë¶„]
ë‘ ë²ˆì§¸ë¡œ ì¤‘ìš”í•œ ê²ƒì€...
(ë‘ ë²ˆì§¸ í•µì‹¬ ë‚´ìš©)

[ë³¸ë¡  3 - 6ë¶„~8ë¶„]
ë§ˆì§€ë§‰ìœ¼ë¡œ ê¼­ ì•Œì•„ì•¼ í•  ê²ƒì€...
(ì„¸ ë²ˆì§¸ í•µì‹¬ ë‚´ìš©)

[ê²°ë¡  - 8ë¶„~9ë¶„]
ì˜¤ëŠ˜ ë‚´ìš©ì„ ì •ë¦¬í•˜ë©´...
${selectedTopic.keywords.map(k => `- ${k}`).join('\n')}

[ì•„ì›ƒíŠ¸ë¡œ - 9ë¶„~10ë¶„]
ì˜¤ëŠ˜ ë‚´ìš© ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”?
ë¹„ìŠ·í•œ ê²½í—˜ì´ë‚˜ ì˜ê²¬ ìˆìœ¼ì‹œë©´ ëŒ“ê¸€ë¡œ ë‚˜ëˆ ì£¼ì„¸ìš”.
êµ¬ë…ê³¼ ì¢‹ì•„ìš”ëŠ” í° í˜ì´ ë©ë‹ˆë‹¤.
ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”! ê°ì‚¬í•©ë‹ˆë‹¤. â¤ï¸`;
}

// ===== ì¸ë„¤ì¼ ì œì•ˆ ìƒì„± =====
function generateThumbnails() {
    const thumbnails = [
        `"${selectedTopic.title.split(',')[0]}" + ì¶©ê²© í‘œì •`,
        `í‚¤ì›Œë“œ "${selectedTopic.keywords[0]}" ê°•ì¡° + í™”ì‚´í‘œ`,
        `"ì´ê±° ëª°ëë‹¤ë©´..." + ë¹¨ê°„ìƒ‰ í¬ì¸íŠ¸`,
        `ìˆ«ì ê°•ì¡° + "${selectedTopic.keywords[1]}" í…ìŠ¤íŠ¸`
    ];

    document.getElementById('thumbnailSuggestions').innerHTML = thumbnails
        .map(t => `<div class="thumb-item">${t}</div>`)
        .join('');
}

// ===== ì½˜í…ì¸  íƒ€ì… ì „í™˜ =====
function switchContentType(type) {
    currentContentType = type;

    document.querySelectorAll('.content-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.type === type);
    });

    if (selectedTopic) {
        generateScript();
    }
}

// ===== ìŠ¤í¬ë¦½íŠ¸ ì¬ìƒì„± =====
function regenerateScript() {
    if (selectedTopic) {
        generateScript();
        showToast('ìŠ¤í¬ë¦½íŠ¸ê°€ ì¬ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
}

// ===== ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ =====
function copyScript() {
    const script = document.getElementById('scriptContent').textContent;
    navigator.clipboard.writeText(script).then(() => {
        showToast('ìŠ¤í¬ë¦½íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    });
}

// ===== í† ìŠ¤íŠ¸ ë©”ì‹œì§€ =====
function showToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #ffa500 0%, #ff6b00 100%);
        color: white;
        padding: 1rem 2rem;
        border-radius: 1rem;
        font-weight: 600;
        z-index: 3000;
        animation: toastIn 0.3s ease;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);

    setTimeout(() => {
        toast.style.animation = 'toastOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 2000);
}

// ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
const style = document.createElement('style');
style.textContent = `
    @keyframes toastIn {
        from { opacity: 0; transform: translateX(-50%) translateY(20px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    @keyframes toastOut {
        from { opacity: 1; transform: translateX(-50%) translateY(0); }
        to { opacity: 0; transform: translateX(-50%) translateY(20px); }
    }
`;
document.head.appendChild(style);


// ===== History Management System =====
const HISTORY_KEY = 'senior_agent_history';
let historyData = [];

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initHistory();
});

function initHistory() {
    // Load data
    try {
        const stored = localStorage.getItem(HISTORY_KEY);
        if (stored) {
            historyData = JSON.parse(stored);
        }
    } catch (e) {
        console.error('Failed to load history:', e);
        historyData = [];
    }

    // Render list
    renderHistoryList();

    // Event Listeners
    const toggleBtn = document.getElementById('toggleHistoryBtn');
    if (toggleBtn) toggleBtn.addEventListener('click', openHistory);

    const closeBtn = document.getElementById('closeHistoryBtn');
    if (closeBtn) closeBtn.addEventListener('click', closeHistory);

    const overlay = document.getElementById('historyOverlay');
    if (overlay) overlay.addEventListener('click', closeHistory);
}

function openHistory() {
    document.getElementById('historySidebar')?.classList.add('open');
    document.getElementById('historyOverlay')?.classList.add('open');
}

function closeHistory() {
    document.getElementById('historySidebar')?.classList.remove('open');
    document.getElementById('historyOverlay')?.classList.remove('open');
}

// Save topic, script, and thumbnail state
function saveCurrentState() {
    if (!selectedTopic) return;

    const scriptContent = document.getElementById('scriptContent')?.innerText;
    const thumbnailHtml = document.getElementById('thumbnailPreview')?.innerHTML;

    // Don't save if nothing generated yet
    if (!scriptContent && !thumbnailHtml) return;

    // Skip if loading message
    if (scriptContent && (scriptContent.includes('ì‘ì„± ì¤‘') || scriptContent.includes('loading'))) return;
    if (thumbnailHtml && (thumbnailHtml.includes('ìƒì„± ì¤‘') || thumbnailHtml.includes('loading'))) return;

    const newItem = {
        id: selectedTopic.id,
        timestamp: Date.now(),
        category: currentCategory,
        topic: selectedTopic,
        script: scriptContent,
        thumbnailHtml: thumbnailHtml
    };

    // Update existing or add new
    const existingIndex = historyData.findIndex(item => item.id === newItem.id);
    if (existingIndex !== -1) {
        // Merge with existing logic (keep thumb if new is empty)
        if (!newItem.thumbnailHtml && historyData[existingIndex].thumbnailHtml) {
            newItem.thumbnailHtml = historyData[existingIndex].thumbnailHtml;
        }
        historyData.splice(existingIndex, 1);
    }

    historyData.unshift(newItem);

    // Limit history size
    if (historyData.length > 20) historyData.pop();

    // Save to local storage
    try {
        localStorage.setItem(HISTORY_KEY, JSON.stringify(historyData));
    } catch (e) {
        console.warn('Storage full, trying to save without image data');
        newItem.thumbnailHtml = ''; // Clear heavy data
        localStorage.setItem(HISTORY_KEY, JSON.stringify(historyData));
    }

    renderHistoryList();
}

function renderHistoryList() {
    const list = document.getElementById('historyList');
    if (!list) return;

    if (historyData.length === 0) {
        list.innerHTML = '<div class="history-empty-state">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    let html = '';
    historyData.forEach(function (item) {
        const date = new Date(item.timestamp).toLocaleString('ko-KR', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        const categoryName = CATEGORY_NAMES[item.category] || 'ê¸°íƒ€';
        const isActive = selectedTopic && selectedTopic.id === item.topic.id ? 'active' : '';
        const hasScript = item.script ? 'ğŸ“' : '';
        const hasThumb = item.thumbnailHtml && !item.thumbnailHtml.includes('placeholder') ? 'ğŸ–¼ï¸' : '';

        html += '<div class="history-item ' + isActive + '" onclick="restoreHistoryItem(\'' + item.id + '\')">';
        html += '<div class="history-item-header">';
        html += '<span class="history-category">' + categoryName + '</span>';
        html += '<div>';
        html += '<span style="font-size:0.75rem">' + hasScript + hasThumb + '</span>';
        html += '<button class="history-delete-btn" onclick="deleteHistoryItem(event, \'' + item.id + '\')">ì‚­ì œ</button>';
        html += '</div></div>';
        html += '<div class="history-title">' + item.topic.title + '</div>';
        html += '<div class="history-date">' + date + '</div>';
        html += '</div>';
    });
    list.innerHTML = html;
}

function deleteHistoryItem(e, id) {
    if (e) e.stopPropagation();
    if (!confirm('ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    historyData = historyData.filter(item => item.id !== id);
    localStorage.setItem(HISTORY_KEY, JSON.stringify(historyData));
    renderHistoryList();
}

function restoreHistoryItem(id) {
    const item = historyData.find(function (i) { return i.id === id; });
    if (!item) {
        console.error('History item not found:', id);
        return;
    }

    console.log('Restoring history item:', item);

    // Restore Global State
    selectedTopic = item.topic;
    currentCategory = item.category || 'story';

    // Restore UI
    // 1. Topic Info
    var categoryName = CATEGORY_NAMES[currentCategory] || 'ì‹œë‹ˆì–´';
    var selectedCategoryEl = document.getElementById('selectedCategory');
    var selectedTitleEl = document.getElementById('selectedTitle');

    if (selectedCategoryEl) selectedCategoryEl.textContent = categoryName;
    if (selectedTitleEl) selectedTitleEl.textContent = item.topic.title;

    var blueOceanEl = document.getElementById('blueOceanScore');
    var competitionEl = document.getElementById('competitionScore');
    var reasonEl = document.getElementById('topicReason');
    var targetEl = document.getElementById('targetAudience');
    var keywordsEl = document.getElementById('keywordsList');

    if (blueOceanEl && item.topic.blueOcean) blueOceanEl.textContent = item.topic.blueOcean;
    if (competitionEl && item.topic.competition) competitionEl.textContent = item.topic.competition;
    if (reasonEl && item.topic.reason) reasonEl.textContent = item.topic.reason;
    if (targetEl && item.topic.targetAudience) targetEl.textContent = item.topic.targetAudience;

    if (keywordsEl && item.topic.keywords) {
        var kwHtml = '';
        item.topic.keywords.forEach(function (kw) {
            kwHtml += '<span class="keyword-tag">#' + kw + '</span>';
        });
        keywordsEl.innerHTML = kwHtml;
    }

    // Show content panels and hide empty state
    var emptyState = document.getElementById('emptyState');
    var selectedTopicPanel = document.getElementById('selectedTopicPanel');
    var revenuePanel = document.getElementById('revenuePanel');
    var contentPanel = document.getElementById('contentPanel');

    if (emptyState) emptyState.style.display = 'none';
    if (selectedTopicPanel) selectedTopicPanel.style.display = 'block';
    if (revenuePanel) revenuePanel.style.display = 'block';
    if (contentPanel) contentPanel.style.display = 'block';

    // Update revenue info
    if (typeof updateRevenueInfo === 'function') {
        updateRevenueInfo();
    }

    // 2. Script
    var scriptEl = document.getElementById('scriptContent');
    if (scriptEl && item.script) {
        scriptEl.textContent = item.script;
        console.log('Script restored:', item.script.substring(0, 100) + '...');
    }

    // 3. Thumbnail
    var thumbEl = document.getElementById('thumbnailPreview');
    var thumbActions = document.getElementById('thumbnailActions');
    if (thumbEl && item.thumbnailHtml) {
        thumbEl.innerHTML = item.thumbnailHtml;
        console.log('Thumbnail restored');

        // Restore generatedThumbnailUrl for download function
        var imgMatch = item.thumbnailHtml.match(/src="(data:image[^"]+)"/);
        if (imgMatch) {
            generatedThumbnailUrl = imgMatch[1];
        }

        if (thumbActions && !item.thumbnailHtml.includes('placeholder')) {
            thumbActions.style.display = 'flex';
        }
    } else if (thumbActions) {
        thumbActions.style.display = 'none';
    }

    renderHistoryList();

    // Mobile: Close Sidebar
    if (window.innerWidth < 1024) {
        closeHistory();
    }

    showToast('ê¸°ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
}
